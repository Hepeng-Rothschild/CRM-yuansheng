<!-- 页面外套 -->
<div class="page-wrapper" id="setup_base">

    <!-- 数据网格 -->
    <div class="datagrid datagrid-striped" id="setup_base_datagrid">

        <!-- 工具条组 -->
        <div class="tool-group">
            <div class="tool-deal">
                <label><button class="btn btn-primary" id="setup_base_add_btn"> <i class="icon icon-plus"></i> 添加</button></label>
                <div class="clearfix"></div>
            </div>
        </div>
        <!-- tool-group -->

        <div class="datagrid-container"></div>
        <ul class="pager btn-mini" data-elements="prev,pages,next"></ul>
    </div>
    <!-- datagrid -->

    <!-- 添加盒子 -->
    <div class="modal modal-for-page fade" aria-hidden="false" id="setup_base_add_box">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">关闭</span></button>
                    <h4 class="modal-title">添加</h4>
                </div>
                <div class="modal-body">
                    <form class="container form-horizontal">
                        <div class="form-group require">
                            <label class="col-sm-2 required" for="setup_base_add_comp">公司名称</label>
                            <div class="col-sm-8"><input type="text" class="form-control" id="setup_base_add_comp"></div>
                        </div>
                        <div class="form-group require">
                            <label class="col-sm-2 required" for="setup_base_add_user">企业管理人</label>
                            <div class="col-sm-8"><input type="text" class="form-control" id="setup_base_add_user"></div>
                        </div>
                        <div class="form-group require">
                            <label class="col-sm-2 required" for="setup_base_add_mail">邮箱</label>
                            <div class="col-sm-8"><input type="text" class="form-control" id="setup_base_add_mail"></div>
                        </div>
                        <div class="form-group require">
                            <label class="col-sm-2 required" for="setup_base_add_tels">电话</label>
                            <div class="col-sm-8"><input type="text" class="form-control" id="setup_base_add_tels"></div>
                        </div>
                        <div class="form-group require">
                            <label class="col-sm-2 required" for="setup_base_add_addr">地址</label>
                            <div class="col-sm-8"><input type="text" class="form-control" id="setup_base_add_addr"></div>
                        </div>
                        <div class="form-group require">
                            <label class="col-sm-2 required" for="setup_base_add_webip">网络IP</label> 
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="setup_base_add_webip">
                                <div class="form-control-static">公司IP改变后，该公司全部人员IP改变</div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary"  id="setup_base_add_submit">提交</button>
                </div>
            </div>
        </div>
    </div>
    <!-- setup_base_add_box -->

    <!-- 修改盒子 -->
    <div class="modal modal-for-page fade" aria-hidden="false" id="setup_base_edit_box">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">关闭</span></button>
                    <h4 class="modal-title">修改</h4>
                </div>
                <div class="modal-body">
                    <form class="container form-horizontal">
                        <div class="form-group require">
                            <label class="col-sm-2 required" for="setup_base_edit_comp">公司名称</label>
                            <div class="col-sm-8"><input type="text" class="form-control" id="setup_base_edit_comp"></div>
                        </div>
                        <div class="form-group require">
                            <label class="col-sm-2 required" for="setup_base_edit_user">企业管理人</label>
                            <div class="col-sm-8"><input type="text" class="form-control" id="setup_base_edit_user"></div>
                        </div>
                        <div class="form-group require">
                            <label class="col-sm-2 required" for="setup_base_edit_mail">邮箱</label>
                            <div class="col-sm-8"><input type="text" class="form-control" id="setup_base_edit_mail"></div>
                        </div>
                        <div class="form-group require">
                            <label class="col-sm-2 required" for="setup_base_edit_tels">电话</label>
                            <div class="col-sm-8"><input type="text" class="form-control" id="setup_base_edit_tels"></div>
                        </div>
                        <div class="form-group require">
                            <label class="col-sm-2 required" for="setup_base_edit_addr">地址</label>
                            <div class="col-sm-8"><input type="text" class="form-control" id="setup_base_edit_addr"></div>
                        </div>
                        <div class="form-group require">
                            <label class="col-sm-2 required" for="setup_base_edit_webip">网络IP</label> 
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="setup_base_edit_webip">
                                <div class="form-control-static">公司IP改变后，该公司全部人员IP改变</div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary"  id="setup_base_edit_submit">提交</button>
                </div>
            </div>
        </div>
    </div>
    <!-- setup_base_edit_box -->

    <!-- 查看盒子 -->
    <div class="modal modal-for-page fade" aria-hidden="false" id="setup_base_show_box">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">关闭</span></button>
                    <h4 class="modal-title">查看</h4>
                </div>
                <div class="modal-body"><!-- JS推进 --></div>
            </div>
        </div>
    </div>
    <!-- setup_base_show_box -->
    
    <!-- 删除盒子 -->
    <div class="modal modal-for-page fade" aria-hidden="false" id="setup_base_dele_box">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">关闭</span></button>
                    <h4 class="modal-title">删除</h4>
                </div>
                <div class="modal-body">
                    <p class="text-danger"><i class="icon icon-warning-sign"></i> 是否删除？</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-danger"  id="setup_base_dele_submit">提交</button>
                </div>
            </div>
        </div>
    </div>
    <!-- setup_base_dele_box -->

</div>
<!-- page-wrapper -->

<script>
$(function(){
   
    //变量声明-----------------------------------------------------------------------------------------------
    var 
    setup_base              = $("#setup_base"),                 //页面ID
    setup_base_datagrid     = $("#setup_base_datagrid"),        //数据表格
    //添加
    setup_base_add_btn      = $("#setup_base_add_btn"),         //添加按钮
    setup_base_add_box      = $("#setup_base_add_box"),         //添加盒子
    setup_base_add_submit   = $("#setup_base_add_submit"),      //添加提交
    setup_base_add_comp     = $("#setup_base_add_comp"),        //公司名称
    setup_base_add_user     = $("#setup_base_add_user"),        //企业管理人
    setup_base_add_mail     = $("#setup_base_add_mail"),        //邮箱
    setup_base_add_tels     = $("#setup_base_add_tels"),        //电话
    setup_base_add_addr     = $("#setup_base_add_addr"),        //地址
    setup_base_add_webip    = $("#setup_base_add_webip"),       //网络IP
    //修改
    setup_base_edit_box     = $("#setup_base_edit_box"),        //修改盒子
    setup_base_edit_submit  = $("#setup_base_edit_submit"),     //修改提交
    setup_base_edit_comp    = $("#setup_base_edit_comp"),       //公司名称
    setup_base_edit_user    = $("#setup_base_edit_user"),       //企业管理人
    setup_base_edit_mail    = $("#setup_base_edit_mail"),       //邮箱
    setup_base_edit_tels    = $("#setup_base_edit_tels"),       //电话
    setup_base_edit_addr    = $("#setup_base_edit_addr"),       //地址
    setup_base_edit_webip   = $("#setup_base_edit_webip"),      //网络IP
    //查看
    setup_base_show_box     = $("#setup_base_show_box"),        //查看盒子
    //删除
    setup_base_dele_box     = $("#setup_base_dele_box"),        //删除盒子
    setup_base_dele_submit  = $("#setup_base_dele_submit");     //删除提交

    //接口对象-----------------------------------------------------------------------------------------------
    if( window.STATE == "local" ){

        //本地接口
        var setup_base_api = {
            datagrid   : LOCAL + "Test/Setup/base.json",        //数据表格
            modal_show : LOCAL + "Test/Setup/base_show.json",   //查看盒子
        }

    } else if ( window.STATE == "route" ){

        //远程接口
        var setup_base_api = {
            datagrid   : LOCAL + "Test/Setup/base.json",        //数据表格
            modal_show : LOCAL + "Test/Setup/base_show.json",   //查看盒子
        }

    }

    //数据表格-----------------------------------------------------------------------------------------------
    setup_base_datagrid.datagrid({
        height      : zui_datagrid_height(setup_base_datagrid),
        sortable    : false,
        cache       : false,
        showRowIndex: true,
        configs     : {
            R0:{className:"text-center"},
            C1:{className:"cell-hidden"}
        },
        states      : {
            pager           : {
                page        : 1,
                recPerPage  : window.REC_PER_PAGE,
            }
        },
        dataSource : {
            cols   : [
                {name:"id",     label:"ID",        width:49 },
                {name:"comp",   label:"公司名称",  width:150},
                {name:"manager",label:"企业管理人",width:100},
                {name:"mail",   label:"邮箱",      width:150},
                {name:"tel",    label:"电话",      width:150},
                {name:"webip",  label:"网络IP",    width:150},
                {name:"operate",label:"操作",      width:150,
                    html:true,
                    valueOperator : {
                        getter : function(dataValue,cell){
                            var temp = `
                                <a class="setup_base_show_btn" rowIndex="${cell.rowIndex}">查看</a>
                                <a class="setup_base_edit_btn" rowIndex="${cell.rowIndex}">修改</a>
                                <a class="setup_base_dele_btn" rowIndex="${cell.rowIndex}">删除</a>
                            `;
                           return temp;
                        }
                    }
                }
            ],
            remote : function(){
                return {
                    url     : setup_base_api.datagrid,
                    type    : "POST",
                    dataType: "json",
                }
            }
        }
    });

    //变量声明-----------------------------------------------------------------------------------------------
    var
    setup_base_datagrid_obj   = setup_base_datagrid.data("zui.datagrid"),   //表格对象
    setup_base_show_btn       = ".setup_base_show_btn",                     //查看    
    setup_base_edit_btn       = ".setup_base_edit_btn",                     //修改
    setup_base_dele_btn       = ".setup_base_dele_btn";                     //删除

    //添加按钮-----------------------------------------------------------------------------------------------
    setup_base_add_btn.click(function(){
        setup_base_add_box.modal("show");
    });
    //添加提交
    setup_base_add_submit.click(function(){
 
        //远程提交
        $.ajax({
            url     : API.test_response,
            type    : "post",
            dataType: "json",
            data    : {
                comp    : setup_base_add_comp.val(),
                user    : setup_base_add_user.val(),
                mail    : setup_base_add_mail.val(),
                tels    : setup_base_add_tels.val(),
                addr    : setup_base_add_addr.val(),
                webip   : setup_base_add_webip.val(),
            },
            success : function(data){
                if( data.status>0 ){
                    um_tip(data.message);
                    zui_datagrid_reset(setup_base_datagrid_obj,setup_base_api.datagrid);
                } else {
                    um_tip(data.message,"1500","text-danger");
                }
            }
        });
    });

    //修改按钮-----------------------------------------------------------------------------------------------
    $(document).on("click",setup_base_edit_btn,function(){
  
        //数据ID
        var data_id  = zui_datagrid_get_id($(this).attr("rowIndex"));

        //远程提交
        $.ajax({
            url     : API.test_response,
            type    : "post",
            dataType: "json",
            data    : { id:data_id },
            success : function(data){
                if( data.status>0 ){
                    //数据赋值
                    setup_base_edit_comp.val(  data.message );
                    setup_base_edit_user.val(  data.message );
                    setup_base_edit_mail.val(  data.message );
                    setup_base_edit_tels.val(  data.message );
                    setup_base_edit_addr.val(  data.message );
                    setup_base_edit_webip.val( data.message );
                    //其他操作
                    setup_base_edit_submit.attr("dataId",data_id);  //数据ID传值
                    setup_base_edit_box.modal("show");              //盒子显示
                } else {
                    um_tip(data.message,"1500","text-danger");
                }
            }
        });

    });
    //修改提交
    setup_base_edit_submit.click(function(){

        //数据ID
        var data_id = $(this).attr("dataId");

        //远程提交
        $.ajax({
            url     : API.test_response,
            type    : "post",
            dataType: "json",
            data    : { 
                id      : data_id,
                comp    : setup_base_edit_comp.val(),
                user    : setup_base_edit_user.val(),
                mail    : setup_base_edit_mail.val(),
                tels    : setup_base_edit_tels.val(),
                addr    : setup_base_edit_addr.val(),
                webip   : setup_base_edit_webip.val(),
             },
            success : function(data){
                if( data.status>0 ){
                    um_tip(data.message);
                    zui_datagrid_reset(setup_base_datagrid_obj,setup_base_api.datagrid);
                } else {
                    um_tip(data.message,"1500","text-danger");
                }
            }
        });

    });

    //查看按钮-----------------------------------------------------------------------------------------------
    $(document).on("click",setup_base_show_btn,function(){

        //数据ID
        var data_id = zui_datagrid_get_id($(this).attr("rowIndex"));

        //远程提交
        $.ajax({
            url     : setup_base_api.modal_show,
            type    : "post",
            dataType: "json",
            data    : { id:data_id },
            success : function(data){
                if( data.status>0 ){
                    var data = data.data;
                    var setup_base_show_temp = `
                        <table class="table table-bordered">
                            <tr><td>公司名称  </td><td>${data.comp} </td></tr>
                            <tr><td>企业管理人</td><td>${data.user} </td></tr>
                            <tr><td>邮箱      </td><td>${data.mail} </td></tr>
                            <tr><td>电话      </td><td>${data.tels} </td></tr>
                            <tr><td>地址      </td><td>${data.addr} </td></tr>
                            <tr><td>网络IP    </td><td>${data.webip}</td></tr>
                        </table>
                    `;
                    setup_base_show_box.find(".modal-body").html(setup_base_show_temp);     //模板填充
                    setup_base_show_box.modal("show");                                      //盒子显示

                } else {
                    um_tip(data.message,"1500","text-danger");
                }
            }
        });
   
    });

    //删除按钮-----------------------------------------------------------------------------------------------
    $(document).on("click",setup_base_dele_btn,function(){

        //数据ID
        var data_id = zui_datagrid_get_id($(this).attr("rowIndex"));

        //其他操作
        setup_base_dele_submit.attr("dataId",data_id);                                //ID传值
        setup_base_dele_box.modal("show");                                            //面板显示

    });
    //删除提交
    setup_base_dele_submit.click(function(){

        //数据ID
        var data_id = $(this).attr("dataId");

        //远程提交
        $.ajax({
            url     : API.test_response,
            type    : "post",
            dataType: "json",
            data    : { id:data_id },
            success : function(data){
                if( data.status>0 ){
                    um_tip(data.message);
                    zui_datagrid_reset(setup_base_datagrid_obj,setup_base_api.datagrid);
                } else {
                    um_tip(data.message,"1500","text-danger");
                }
            }
        });

    });

});//预加载结尾
</script>