<!-- 页面外套 -->
<div class="page-wrapper" id="design_sign">

    <!-- 数据网格 -->
    <div class="datagrid datagrid-striped">
        <!-- 工具条组 -->
        <div class="tool-group">
            <form class="tool-search">
                <input type="hidden" name='page'>
                <input type="hidden" name='recPerPage'>
                <div class="im-label">
                    <div class="input-group">
                        <select class="form-control" name="sid">
                            <option value="1">项目编号</option>
                            <option value="1">项目名称</option>
                            <option value="1">装修地址</option>
                            <option value="1">信息员  </option>
                            <option value="1">业务员  </option>
                            <option value="1">项目联系人</option>
                            <option value="1">手机号码</option>
                        </select>
                        <span class="input-group-addon fix-border fix-padding"></span>
                        <input type="text" class="form-control" name="search">
                    </div>
                </div>
                <label>
                    <span>项目状态：</span>
                    <select class="form-control" name="state">
                        <option value="0">全部</option>
                        <option value="1">在谈</option>
                        <option value="2">已签</option>
                        <option value="3">未签申请中</option>
                        <option value="4">未签已归库</option>
                        <option value="5">不准申请中</option>
                        <option value="6">不准已归库</option>
                    </select>
                </label>
                <label>
                    <span>洽谈级别：</span>
                    <select class="form-control" name="level">
                        <option value="0">全部</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                    </select>
                </label>
                <div class="im-label">
                    <span>时间：</span>
                    <div class="input-group">
                        <input type="text" class="form-control" name="starttime" readonly> 
                        <span class="input-group-addon fix-border fix-padding"></span>
                        <input type="text" class="form-control" name="endtime"readonly>
                    </div>
                </div>
                <label><button type="button" class="btn btn-primary tool_search_btn"><i class="icon icon-search"></i> 搜索</button></label>
                <div class="clearfix"></div>
            </form>
            <div class="tool-deal">
                <label><button class="btn btn-primary tool_turn_btn">  <i class="icon icon-exchange"></i>      转移客户</button></label>
                <label><button class="btn btn-primary tool_change_btn"><i class="icon icon-signin"></i>        客户交接</button></label>
                <label><button class="btn btn-primary tool_export_btn"><i class="icon icon-external-link"></i> 导出</button></label>
                <div class="clearfix"></div>
            </div>
        </div>
        <!-- tool-group -->

        <div class="datagrid-container"></div>
        <ul class="pager btn-mini" data-elements="prev,pages,next"></ul>
    </div>
    <!-- datagrid -->
 
    <!-- 转移客户 -->
    <div class="modal modal-for-page fade tool_turn_box" aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">关闭</span></button>
                    <h4 class="modal-title">转移客户</h4>
                </div>
                <div class="modal-body">
                    <form class="container form-horizontal">
                        <input type="hidden" name="ids">
                        <div class="form-group">
                            <label class="col-sm-2 required">项目编号</label>
                            <div class="col-sm-8"><input type="text" class="form-control" readonly name="item"></div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 required">原设计师</label>
                            <div class="col-sm-8"><input type="text" class="form-control" readonly name="pre"></div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 required">新设计师</label>
                            <div class="col-sm-8"><select class="form-control tool_turn_box_newDesigner" name="new"><!--JS推进--></select></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary tool_turn_submit">提交</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 客户交接 -->
    <div class="modal modal-for-page fade tool_change_box">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">关闭</span></button>
                    <h4 class="modal-title">客户交接</h4>
                </div>
                <div class="modal-body">
                    <form class="container form-horizontal">
                        <input type="hidden" name="ids">
                        <div class="form-group">
                            <label class="col-sm-2 required">离职人员</label>
                            <div class="col-sm-8"><select class="form-control tool_change_box_selectQuit"   name="quit"><!-- JS推进 --></select></div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 required">目标人员</label>
                            <div class="col-sm-8"><select class="form-control tool_change_box_selectTarget" name="target"><!-- JS推进 --></select>
                                <span class="text-gray">注：业务人员项目交接。是指将“离职人员”名下所有“正跟踪”和“在谈”项目转到“目标人员”名下</span>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary tool_change_submit">提交</button>
                </div>
            </div>
        </div>
    </div>

</div>
<!-- page-wrapper -->


<!-- 项目分单详情 -->
<div class="detail-wrapper mode-show" id="design_sign_detail">
    
    <!-- 详情弹框 -->
    <div class="modal modal-for-page fade detail_box" aria-hidden="false">
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">关闭</span></button>
                    <h4 class="modal-title">签单列表详情</h4>
                </div>
                <div class="modal-body modal-scroll">

                    <!-- 操作按钮
                    返回                                共有
                    申请退单    detail_return_btn       共有
                    提交工程部  detail_submitEngine_btn 施工单独有(JS根据.detail_engineBtn进行显示隐藏)
                    打回设计师  detail_backDesign_btn   施工单独有(JS根据.detail_engineBtn进行显示隐藏)
                    -->
                    <button class="btn" data-dismiss="modal"><i class="icon icon-arrow-left"></i> 返回</button>
					<button class="btn btn-primary" data-toggle="modal" data-target=".detail_return_box">申请退单</button>
					<button class="btn btn-primary detail_engineBtn" data-toggle="modal" data-target=".detail_submitEngine_box">提交工程部</button>
					<button class="btn btn-primary detail_engineBtn" data-toggle="modal" data-target=".detail_backDesign_box"  >打回设计师</button>
 
                    <!-- 数据表单 -->
                    <form class="detail_box_form">
                        <input type="hidden" name="detailId">
                        <table class="table"><!--JS推进--></table>
                    </form>

                    <!-- 切换表格 -->
                    <ul class="nav nav-tabs">
                        <li class="active"><a data-tab="" href=".detail_tab1">业务回访</a></li>
                        <li><a data-tab="" href=".detail_tab2">设计回访</a></li>
                        <li><a data-tab="" href=".detail_tab3">过程记录</a></li>
                        <li><a data-tab="" href=".detail_tab4">回款记录</a></li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane active detail_tab1">
                            <form class="tool-search">
                                <input type="hidden" name='page'>
                                <input type="hidden" name='recPerPage'>
                                <input type="hidden" name="detailId" value="null">
                            </form>
                            <div class="datagrid datagrid-striped">
                                <div class="datagrid-container"></div>
                                <ul class="pager btn-mini" data-elements="first_icon,prev_icon,next_icon,last_icon,size_menu,goto,page_of_total_text" data-menu-direction="dropup"></ul>
                            </div>
                        </div>
                        <div class="tab-pane detail_tab2">
                            <form class="tool-search">
                                <input type="hidden" name='page'>
                                <input type="hidden" name='recPerPage'>
                                <input type="hidden" name="detailId" value="null">
                            </form>
                            <div class="datagrid datagrid-striped">
                                <div class="datagrid-container"></div>
                                <ul class="pager btn-mini" data-elements="first_icon,prev_icon,next_icon,last_icon,size_menu,goto,page_of_total_text" data-menu-direction="dropup"></ul>
                            </div>
                        </div>
                        <div class="tab-pane detail_tab3">
                            <form class="tool-search">
                                <input type="hidden" name='page'>
                                <input type="hidden" name='recPerPage'>
                                <input type="hidden" name="detailId" value="null">
                            </form>
                            <div class="datagrid datagrid-striped">
                                <div class="datagrid-container"></div>
                                <ul class="pager btn-mini" data-elements="first_icon,prev_icon,next_icon,last_icon,size_menu,goto,page_of_total_text" data-menu-direction="dropup"></ul>
                            </div>
                        </div>
                        <div class="tab-pane detail_tab4">
                            <form class="tool-search">
                                <input type="hidden" name='page'>
                                <input type="hidden" name='recPerPage'>
                                <input type="hidden" name="detailId" value="null">
                            </form>
                            <div class="datagrid datagrid-striped">
                                <div class="datagrid-container"></div>
                                <ul class="pager btn-mini" data-elements="first_icon,prev_icon,next_icon,last_icon,size_menu,goto,page_of_total_text" data-menu-direction="dropup"></ul>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- 申请退单 -->
    <div class="modal modal-for-page fade detail_return_box" aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">关闭</span></button>
                    <h4 class="modal-title">申请退单</h4>
                </div>
                <div class="modal-body">
                    <div class="container">确定申请退单吗？</div>
                    <form><input type="hidden" name="detailId"></form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary detail_return_submit">提交</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 提交工程部 -->
    <div class="modal modal-for-page fade detail_submitEngine_box" aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">关闭</span></button>
                    <h4 class="modal-title">提交工程部</h4>
                </div>
                <div class="modal-body">
                    <div class="container">确定提交工程部吗？</div>
                    <form><input type="hidden" name="detailId"></form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary detail_submitEngine_submit">提交</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 打回设计师 -->
    <div class="modal modal-for-page fade detail_backDesign_box" aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">关闭</span></button>
                    <h4 class="modal-title">打回设计师</h4>
                </div>
                <div class="modal-body">
                    <div class="container">确定打回设计师吗？</div>
                    <form><input type="hidden" name="detailId"></form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary detail_backDesign_submit">提交</button>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
$(function() {
    //变量声明-----------------------------------------------------------------------------------------------
    var design_sign = $("#design_sign"); //页面ID
    var design_sign_api = {
        datagrid : API.test_datagrid, // 数据表格
        turn : API.test_response, // 转移客户
        change : API.test_response, // 客户交接
        export : API.test_response, // 导出
        designer : LOCAL + "Test/test_select.json", //转移客户-新设计师
        quit : LOCAL + "Test/test_select.json", //下拉选择
        target : LOCAL + "Test/test_select.json", //下拉选择
        show : LOCAL + "Test/Template/design_sign.json", // 详情查看
        return : API.test_response, // 申请退单
        submitEngine : API.test_response, // 提交工程部
        backDesign : API.test_response, // 打回设计师
        tab1 : API.test_datagrid, // 切换表格1
        tab2 : API.test_datagrid, // 切换表格2
        tab3 : API.test_datagrid, // 切换表格3
        tab4 : API.test_datagrid, // 切换表格4
    }

    //组件实例化---------------------------------------------------------------------------------------------
    design_sign.find('[name="starttime"]').datetimepicker(option_date);
    design_sign.find('[name="endtime"]').datetimepicker(option_date);

    //数据表格-----------------------------------------------------------------------------------------------
    //数据源
    var design_sign_dataSource = {
        cols   : [
            {name: "datetime",label: "合同时间",width: 140},
            {name: "name", label: "项目编号",width: 90,html: true,
                valueOperator: {
                    getter: function(dataValue, cell) {
                        var dataType = cell.config.data.state == 1 ? 'design' : 'engine'; //根据state判断是[设计]还是[施工] (暂为 design==1 engine!=1)
                        return `<a class="line_show_btn" dataId="${cell.config.data.id}" dataType="${dataType}">${dataValue}</a>`;
                    }
                }
            },
            {name: "text4",label: "项目名称",   width: 90 },
            {name: "text4",label: "合同编号",   width: 90 },
            {name: "state",label: "合同类型",   width: 90 },
            {name: "text4",label: "合同名称",   width: 90 },
            {name: "text4",label: "合同总金额", width: 90 },
            {name: "text4",label: "增减项",     width: 90 },
            {name: "text4",label: "已收金额",   width: 90 },
            {name: "text4",label: "未收金额",   width: 90 },
            {name: "text4",label: "项目状态",   width: 90 },
            {name: "text4",label: "业务员",     width: 90 },
            {name: "text4",label: "主案设计师", width: 90 },
            {name: "text4",label: "项目经理",   width: 90 },
        ],
        remote : function(){
            return zui_datagrid_remote({
                page_dom : design_sign, 
                url      : design_sign_api.datagrid
            });
        },
        remoteConverter : function(data){ 
            return zui_datagrid_filter({
                page_dom : design_sign,
                data     : data
            });
        }
    };
    //实例化
    design_sign.find('.datagrid').datagrid(
        zui_datagrid_option({
            checkable  : true,
            datagrid   : design_sign.find('.datagrid'),
            dataSource : design_sign_dataSource
        })
    );
    //搜索
    design_sign.find('.tool_search_btn').click(function(){ 
        zui_datagrid_render({
            datagrid_obj : design_sign.find('.datagrid').data("zui.datagrid"),
            dataSource   : design_sign_dataSource
        }); 
    });

    //工具条-转移客户
    design_sign.on('click', '.tool_turn_btn', function(){
        common_form_reset();
        //ID获取
        var data_arr = design_sign.find('.datagrid').data("zui.datagrid").getCheckItems().filter(function(e){return e});
        if (data_arr.length > 0) {

            //ID获取
            var data_id = [];
            for (var i = 0; i < data_arr.length; i++) {
                data_id.push(data_arr[i].id);
            }

            //项目编号获取
            var data_item = [];
            for (var x = 0; x < data_id.length; x++) {
                data_item.push(data_arr[x].username);
            }

            //原商务专员获取
            var data_pre = [];
            for (var p = 0; p < data_id.length; p++) {
                data_pre.push(data_arr[p].name);
            }

            //数据赋值
            design_sign.find('.tool_turn_box [name="item"]').val(data_item.join(","));
            design_sign.find('.tool_turn_box [name="pre"]').val(data_pre.join(","));
            design_sign.find('.tool_turn_box [name="ids"]').val(data_id.join(","));

            //下拉获取
            um_select_option({
                dom : design_sign.find('.tool_turn_box_newDesigner'),
                url : design_sign_api.designer,
            });

            //面板显示
            design_sign.find('.tool_turn_box').modal('show');
        } else {
            um_tip("至少选择一条数据", "1000", "text-danger");
        }
    });
    //提交
    design_sign.on('click', '.tool_turn_submit', function(){
        um_data_submit({
            url : design_sign_api.turn,
            form : design_sign.find('.tool_turn_box form'),
            dataSource : design_sign_dataSource,
            checkClear : true
        });
    });

    //工具条-客户交接
    design_sign.on('click', '.tool_change_btn', function(){
        common_form_reset();
        //ID获取
        var data_arr = design_sign.find('.datagrid').data("zui.datagrid").getCheckItems().filter(function(e){return e});
        if (data_arr.length > 0) {

            //ID获取
            var data_id = [];
            for (var i = 0; i < data_arr.length; i++) {
                data_id.push(data_arr[i].id);
            }

            //数据赋值
            design_sign.find('.tool_change_box [name="ids"]').val(data_id.join(","));

            //下拉获取
            um_select_option({
                dom : design_sign.find('.tool_change_box_selectQuit'),
                url : design_sign_api.quit,
            });

            //下拉获取
            um_select_option({
                dom : design_sign.find('.tool_change_box_selectTarget'),
                url : design_sign_api.target,
            });

            //面板显示
            design_sign.find('.tool_change_box').modal('show');

        } else {
            um_tip("至少选择一条数据", "1000", "text-danger");
        }
    });
    //提交
    design_sign.on('click', '.tool_change_submit', function(){
        um_data_submit({
            url : design_sign_api.change,
            form: design_sign.find('.tool_change_box form'),
            dataSource : design_sign_dataSource,
            checkClear : true
        });
    });

    //工具条-导出
    design_sign.on('click', '.tool_export_btn', function(){
        var data_arr = design_sign.find('.datagrid').data("zui.datagrid").getCheckItems().filter(function(e){return e});
        var data_id = [];
        for (var i = 0; i < data_arr.length; i++) {
            data_id.push(data_arr[i].id);
        }
        if (data_arr.length > 0) {
            $.ajax({
                url: design_sign_api.export,
                type: "post",
                dataType: "json",
                data: um_data_get( design_sign.find('form.tool-search') ),
                beforesend: function() {
                    um_tip("导出中…");
                },
                success: function(data) {
                    if (data.status > 0) {
                        window.open(API.test_export);
                    } else {
                        um_tip(data.message, "1500", "text-danger");
                    }
                }
            });
        } else {
            um_tip("至少选择一条数据", "1000", "text-danger");
        }
    });

    //详情部分---------------------------------------------------------------------------
    //变量声明
    var design_sign_detail = $("#design_sign_detail");
    var design_sign_detail_dataSource_tab1 = {
        cols   : [
            {name:"name",    label:"回访人",      width:80 },
            {name:"tex10",   label:"回访内容",    width:200},
            {name:"datetime",label:"回访时间",    width:140},
            {name:"datetime",label:"下次回访时间",width:140}
        ],
        remote : function(){
            return zui_datagrid_remote({
                page_dom : design_sign_detail.find('.detail_tab1'), 
                url      : design_sign_api.tab1
            });
        },
        remoteConverter : function(data){ 
            return zui_datagrid_filter({
                page_dom : design_sign_detail.find('.detail_tab1'),
                data     : data
            });
        }
    }
    var design_sign_detail_dataSource_tab2 = {
        cols   : [
            {name:"username",label:"回访人",      width:80 },
            {name:"datetime",label:"回访时间",    width:140},
            {name:"datetime",label:"下次回访时间",width:140},
            {name:"text5",   label:"负责人情况",  width:200},
            {name:"text2",   label:"对手进展",    width:80 },
            {name:"text2",   label:"跟进情况",    width:80 },
            {name:"state",   label:"现阶段困难",  width:180},
            {name:"text2",   label:"外协情况",    width:80 },
            {name:"text2",   label:"经理批复",    width:180}
        ],
        remote : function(){
            return zui_datagrid_remote({
                page_dom : design_sign_detail.find('.detail_tab2'), 
                url      : design_sign_api.tab2
            });
        },
        remoteConverter : function(data){ 
            return zui_datagrid_filter({
                page_dom : design_sign_detail.find('.detail_tab2'),
                data     : data
            });
        }
    }
    var design_sign_detail_dataSource_tab3 = {
        cols   : [
            {name:"username",label:"操作人",  width:80 },
            {name:"datetime",label:"操作时间",width:140},
            {name:"text5",   label:"过程说明",width:140}
        ],
        remote : function(){
            return zui_datagrid_remote({
                page_dom : design_sign_detail.find('.detail_tab3'), 
                url      : design_sign_api.tab3
            });
        },
        remoteConverter : function(data){ 
            return zui_datagrid_filter({
                page_dom : design_sign_detail.find('.detail_tab3'),
                data     : data
            });
        }
    }
    var design_sign_detail_dataSource_tab4 = {
        cols   : [
            {name:"datetime",label:"申请时间",width:140},
            {name:"text5",   label:"申请金额",width:140},
            {name:"text5",   label:"申请理由",width:140},
            {name:"text5",   label:"状态",    width:140}
        ],
        remote : function(){
            return zui_datagrid_remote({
                page_dom : design_sign_detail.find('.detail_tab3'), 
                url      : design_sign_api.tab3
            });
        },
        remoteConverter : function(data){ 
            return zui_datagrid_filter({
                page_dom : design_sign_detail.find('.detail_tab3'),
                data     : data
            });
        }
    }

    //详情弹框
    design_sign.on("click", '.line_show_btn', function() {
        var dataId = $(this).attr('dataId');
        var dataType = $(this).attr('dataType');
        var engineBtn = design_sign_detail.find('.detail_engineBtn');
        dataType === 'engine' ? engineBtn.show() : engineBtn.hide(); // 施工单独有按钮-显示隐藏
        design_sign_detail.find('[name="detailId"]').val(dataId); // 详情ID赋值(多个)
        //远程请求
        $.ajax({
            url     : design_sign_api.show,
            type    : "post",
            dataType: "json",
            data    : { id: dataId },
            success : function(data){
                if( data.status>0 ){
                    var data = data.data;
                    //基础表格
                    var temp = '';
                    if (dataType === 'design') { // 设计单模板
                        temp = `
                        <thead><tr><td colspan="3"><div class="flex-box"><b>项目状态</b>${data.itemstatename}</div></td></tr></thead>
                        <tbody>
                            <tr>
                                <td><div class="flex-box"><b>项目编号</b>${data.number}</div></td>
                                <td><div class="flex-box"><b>业务员  </b>${data.salesman}</div></td>
                                <td><div class="flex-box"><b>设计师  </b>${data.designer}</div></td>
                            </tr>
                            <tr>
                                <td><div class="flex-box"><b>甲方负责人</b>${data.user1}</div></td>
                                <td><div class="flex-box"><b>手机号码1 </b>${data.tel1}</div></td>
                                <td><div class="flex-box"><b>手机号码2 </b>${data.tel2}</div></td>
                            </tr>
                            <tr>
                                <td><div class="flex-box"><b>合同编号</b>${data.connumb}</div></td>
                                <td><div class="flex-box"><b>合同名称</b>${data.conname}</div></td>
                                <td><div class="flex-box"><b>合同日期</b>${data.condate}</div></td>
                            </tr>
                            <tr>
                                <td><div class="flex-box"><b>合同金额</b>${data.conmoney}<em class="text-danger">含增减项：${data.conmoneyitem}</em></div></td>
                                <td><div class="flex-box"><b>合同类型</b>${data.contypename}</div></td>
                                <td><div class="flex-box"><b>折扣率  </b>${data.discount}</div></td>
                            </tr>
                            <tr>
                                <td><div class="flex-box"><b>税点    </b>${data.taxpoint}</div></td>
                                <td><div class="flex-box"><b>税金    </b>${data.taxmoney}</div></td>
                                <td><div class="flex-box"><b>是否开票</b>${data.invoicename}</div></td>
                            </tr>
                            <tr>
                                <td><div class="flex-box"><b>协调费用</b>${data.moneyhelp}</div></td>
                                <td colspan="2"><div class="flex-box"><b>其他费用</b>${data.moneyother}</div></td>
                            </tr>
                            <tr>
                                <td><div class="flex-box"><b>已收款</b>${data.moneygot}</div></td>
                                <td><div class="flex-box"><b>未收款</b>${data.moneynot}</div></td>
                                <td><div class="flex-box"><b>坏账  </b>${data.moneybad}</div></td>
                            </tr>
                            <tr><td colspan="3"><div class="flex-box"><b>收款说明</b>${data.moneyinfo}</div></td></tr>
                            <tr><td colspan="3"><div class="flex-box"><b>备注信息</b>${data.text}</div></td></tr>
                        </tbody>
                        `;
                    } else if (dataType === 'engine') { // 施工单模板
                        temp = `
                        <thead><tr><td colspan="3"><div class="flex-box"><b>工程状态</b>${data.itemstatename}</div></td></tr></thead>
                        <tbody>
                            <tr>
                                <td><div class="flex-box"><b>项目编号</b>${data.number}</div></td>
                                <td><div class="flex-box"><b>业务员  </b>${data.salesman}</div></td>
                                <td><div class="flex-box"><b>设计师  </b>${data.designer}</div></td>
                            </tr>
                            <tr>
                                <td><div class="flex-box"><b>甲方负责人</b>${data.user1}</div></td>
                                <td><div class="flex-box"><b>手机号码1 </b>${data.tel1}</div></td>
                                <td><div class="flex-box"><b>手机号码2 </b>${data.tel2}</div></td>
                            </tr>
                            <tr>
                                <td><div class="flex-box"><b>合同编号</b>${data.connumb}</div></td>
                                <td><div class="flex-box"><b>合同名称</b>${data.conname}</div></td>
                                <td><div class="flex-box"><b>合同日期</b>${data.condate}</div></td>
                            </tr>
                            <tr>
                                <td><div class="flex-box"><b>合同总额</b>${data.conmoneys}<em class="text-danger">含增减项：${data.conmoneysitem}</em></div></td>
                                <td><div class="flex-box"><b>装饰合同</b>${data.conmoney1}<em class="text-danger">含增减项：${data.conmoney1item}</em></div></td>
                                <td><div class="flex-box"><b>家具合同</b>${data.conmoney2}<em class="text-danger">含增减项：${data.conmoney2item}</em></div></td>
                            </tr>
                            <tr>
                                <td><div class="flex-box"><b>空调合同</b>${data.conmoney3}<em class="text-danger">含增减项：${data.conmoney3item}</em></div></td>
                                <td><div class="flex-box"><b>消防合同</b>${data.conmoney4}<em class="text-danger">含增减项：${data.conmoney4item}</em></div></td>
                                <td><div class="flex-box"><b>弱电合同</b>${data.conmoney5}<em class="text-danger">含增减项：${data.conmoney5item}</em></div></td>
                            </tr>
                            <tr>
                                <td><div class="flex-box"><b>合同质保金</b>${data.conquality}</div></td>
                                <td><div class="flex-box"><b>合同类型</b>${data.contypename}</div></td>
                                <td><div class="flex-box"><b>折扣率  </b>${data.discount}</div></td>
                            </tr>
                            <tr>
                                <td><div class="flex-box"><b>税点    </b>${data.taxpoint}</div></td>
                                <td><div class="flex-box"><b>税金    </b>${data.taxmoney}</div></td>
                                <td><div class="flex-box"><b>是否开票</b>${data.invoicename}</div></td>
                            </tr>
                            <tr>
                                <td><div class="flex-box"><b>管理费用</b>${data.moneyadmin}</div></td>
                                <td><div class="flex-box"><b>协调费用</b>${data.moneyhelp}</div></td>
                                <td><div class="flex-box"><b>其他费用</b>${data.moneyother}</div></td>
                            </tr>
                            <tr>
                                <td><div class="flex-box"><b>已收款</b>${data.moneygot}</div></td>
                                <td><div class="flex-box"><b>未收款</b>${data.moneynot}</div></td>
                                <td><div class="flex-box"><b>尾款转嫁/坏账</b>${data.moneybad}</div></td>
                            </tr>
                            <tr>
                                <td><div class="flex-box"><b>开工日期</b>${data.starttime}</div></td>
                                <td><div class="flex-box"><b>预计完工日期</b>${data.endtime}</div></td>
                                <td><div class="flex-box"><b>工期</b>${data.duration}</div></td>
                            </tr>
                            <tr>
                                <td><div class="flex-box"><b>工程等级</b>${data.englevel}</div></td>
                                <td><div class="flex-box"><b>工程面积</b>${data.engarea}</div></td>
                                <td><div class="flex-box"><b>工程地址</b>${data.engaddress}</div></td>
                            </tr>
                            <tr>
                                <td><div class="flex-box"><b>工程类型</b>${data.engtype}</div></td>
                                <td><div class="flex-box"><b>工程监理</b>${data.engadmin}</div></td>
                                <td><div class="flex-box"><b>项目经理</b>${data.itemadmin}</div></td>
                            </tr>
                            <tr>
                                <td><div class="flex-box"><b>物业名称  </b>${data.propname}</div></td>
                                <td><div class="flex-box"><b>物业负责人</b>${data.proadmin}</div></td>
                                <td><div class="flex-box"><b>负责人电话</b>${data.proptel}</div></td>
                            </tr>
                            <tr>
                                <td><div class="flex-box"><b>报价单上传</b>${data.budget}</div></td>
                                <td colspan="2"><div class="flex-box"><b>图纸上传</b>${data.drawing}</div></td>
                            </tr>
                            <tr><td colspan="3"><div class="flex-box"><b>收款说明</b>${data.moneyinfo}</div></td></tr>
                            <tr><td colspan="3"><div class="flex-box"><b>备注信息</b>${data.text}</div></td></tr>
                        </tbody>
                        `;
                    }
                    design_sign_detail.find('.detail_box .detail_box_form table').html(temp); // DOM填充
                    //切换表格刷新
                    zui_datagrid_render({
                        datagrid_obj : design_sign_detail.find('.detail_tab1 .datagrid').data("zui.datagrid"),
                        dataSource   : design_sign_detail_dataSource_tab1
                    });
                    zui_datagrid_render({
                        datagrid_obj : design_sign_detail.find('.detail_tab2 .datagrid').data("zui.datagrid"),
                        dataSource   : design_sign_detail_dataSource_tab2
                    });
                    zui_datagrid_render({
                        datagrid_obj : design_sign_detail.find('.detail_tab3 .datagrid').data("zui.datagrid"),
                        dataSource   : design_sign_detail_dataSource_tab3
                    });
                    zui_datagrid_render({
                        datagrid_obj : design_sign_detail.find('.detail_tab4 .datagrid').data("zui.datagrid"),
                        dataSource   : design_sign_detail_dataSource_tab4
                    });
                    design_sign_detail.find('.detail_box').modal('show'); // 弹框显示
                } else {
                    um_tip(data.message,"1500","text-danger");
                }
            }
        });
 
    });

    //操作按钮-申请退单
    design_sign_detail.on("click", '.detail_return_submit', function() {
        um_data_submit({
            url         : design_sign_api.return,
            form        : design_sign_detail.find('.detail_return_box form'),
            datagridDom : design_sign.find('.datagrid'),
            dataSource  : design_sign_dataSource,
        });
    });

    //操作按钮-提交工程部
    design_sign_detail.on("click", '.detail_submitEngine_submit', function() {
        um_data_submit({
            url         : design_sign_api.submitEngine,
            form        : design_sign_detail.find('.detail_submitEngine_box form'),
            datagridDom : design_sign.find('.datagrid'),
            dataSource  : design_sign_dataSource,
        });
    });

    //操作按钮-打回设计师
    design_sign_detail.on("click", '.detail_backDesign_submit', function() {
        um_data_submit({
            url         : design_sign_api.backDesign,
            form        : design_sign_detail.find('.detail_backDesign_box form'),
            datagridDom : design_sign.find('.datagrid'),
            dataSource  : design_sign_dataSource,
        });
    });

    //切换表格-业务回访
    design_sign_detail.find('.detail_tab1 .datagrid').datagrid(
        zui_datagrid_option({
            height     : 400,
            datagrid   : design_sign_detail.find('.detail_tab1 .datagrid'),
            dataSource : design_sign_detail_dataSource_tab1
        })
    );
    //切换表格-设计回访
    design_sign_detail.find('.detail_tab2 .datagrid').datagrid(
        zui_datagrid_option({
            height     : 400,
            datagrid   : design_sign_detail.find('.detail_tab2 .datagrid'),
            dataSource : design_sign_detail_dataSource_tab2
        })
    );
    //切换表格-过程记录
    design_sign_detail.find('.detail_tab3 .datagrid').datagrid(
        zui_datagrid_option({
            height     : 400,
            datagrid   : design_sign_detail.find('.detail_tab3 .datagrid'),
            dataSource : design_sign_detail_dataSource_tab3
        })
    );
    //切换表格-回款记录
    design_sign_detail.find('.detail_tab4 .datagrid').datagrid(
        zui_datagrid_option({
            height     : 400,
            datagrid   : design_sign_detail.find('.detail_tab4 .datagrid'),
            dataSource : design_sign_detail_dataSource_tab4
        })
    );

}); //预加载结尾
</script>