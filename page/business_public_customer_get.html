<!-- 页面外套 -->
<div class="page-wrapper" id="business_public_customer_get">

    <!-- 数据网格 -->
    <div class="datagrid datagrid-striped" id="business_public_customer_get_datagrid">

        <!-- 工具条组 -->
        <div class="tool-group">
            <div class="tool-search">
                <div class="im-label">
                    <div class="input-group">
                        <select class="form-control" id="business_public_customer_get_tool_keys">
                            <option value="1">项目编号</option>
                            <option value="2">项目名称</option>
                            <option value="3">信息员</option>
                            <option value="4">业务员</option>
                            <option value="5">项目联系人</option>
                            <option value="6">联系电话</option>
                        </select>
                        <span class="input-group-addon fix-border fix-padding"></span>
                        <input type="text" class="form-control" id="business_public_customer_get_tool_search">
                    </div>
                </div>
                <label><button class="btn btn-primary" id="business_public_customer_get_search_btn"><i class="icon icon-search"></i> 搜索</button></label>
                <div class="clearfix"></div>
            </div>
            <div class="tool-deal">
                <label><button class="btn btn-primary" id="business_public_customer_get_occupy_btn"> <i class="icon icon-flag"></i> 隶属于我</button></label>
                <div class="clearfix"></div>
            </div>
        </div>
        <!-- tool-group -->

        <div class="datagrid-container"></div>
        <ul class="pager btn-mini" data-elements="prev,pages,next"></ul>
    </div>
    <!-- datagrid -->

    <!-- 隶属于我盒子 -->
    <div class="modal modal-for-page fade" aria-hidden="false" id="business_public_customer_get_occupy_box">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">关闭</span></button>
                    <h4 class="modal-title">隶属于我</h4>
                </div>
                <div class="modal-body">
                    <p>您确定要选中的客户隶属于自己名下吗？</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" id="business_public_customer_get_occupy_submit">提交</button>
                </div>                
            </div>
        </div>
    </div>
    <!-- business_public_customer_get_occupy_box -->

</div>
<!-- page-wrapper -->

<script>
$(function(){
    
    //变量声明-----------------------------------------------------------------------------------------------
    var 
    business_public_customer_get                = $("#business_public_customer_get"),               //页面ID
    business_public_customer_get_datagrid       = $("#business_public_customer_get_datagrid"),      //数据表格
    //搜索
    business_public_customer_get_tool_keys      = $("#business_public_customer_get_tool_keys"),     //搜索类别
    business_public_customer_get_tool_search    = $("#business_public_customer_get_tool_search"),   //搜索字段
    business_public_customer_get_search_btn     = $("#business_public_customer_get_search_btn"),    //搜索按钮
    //隶属于我
    business_public_customer_get_occupy_box     = $("#business_public_customer_get_occupy_box"),    //隶属于我盒子
    business_public_customer_get_occupy_btn     = $("#business_public_customer_get_occupy_btn"),    //隶属于我按钮
    business_public_customer_get_occupy_submit  = $("#business_public_customer_get_occupy_submit"); //隶属于我按钮    

    //接口对象-----------------------------------------------------------------------------------------------
    if( window.STATE == "local" ){

        //本地接口
        var business_public_customer_get_api = {
            datagrid : LOCAL + "Test/test_datagrid.json", //数据表格
        }

    } else if ( window.STATE == "route" ){
    }

    //数据表格-----------------------------------------------------------------------------------------------
    business_public_customer_get_datagrid.datagrid({
        height      : zui_datagrid_height(business_public_customer_get_datagrid),
        sortable    : false,
        cache       : false,
        showRowIndex: true,
        checkable   : true,
        checkByClickRow:false,
        selectable  : false,
        configs     : {
            R0:{className:"text-center"},
            C1:{className:"cell-hidden"}
        },
        states      : {
            pager           : {
                page        : 1,
                recPerPage  : window.REC_PER_PAGE,
            }
        },
        dataSource : {
            cols   : [
                {name:"id",      label:"ID",      width:49},
                {name:"username",label:"项目编号",width:100,html:true,
                    valueOperator : {
                        getter : function(dataValue,cell){
                            return `<a rowIndex="${cell.rowIndex}" onclick=template_page_open('detail_customer',$(this))>${dataValue}</a>`;
                        }
                    }
                },
                {name:"text8",   label:"项目名称",    width:150},
                {name:"name",    label:"联系人",      width:80 },
                {name:"name",    label:"信息员",      width:80 },
                {name:"name",    label:"业务员",      width:80 },
                {name:"name",    label:"设计师",      width:80 },
                {name:"tex10",   label:"项目状态",    width:150},
                {name:"text2",   label:"房源状态",    width:80 },
                {name:"text2",   label:"回访过期",    width:80 },
                {name:"tex10",   label:"装修地址",    width:150},               
            ],
            remote : function(){
                return {
                    url     : business_public_customer_get_api.datagrid,
                    type    : "POST",
                    dataType: "json",
                }
            }
        }
    });

    //变量声明-----------------------------------------------------------------------------------------------
    var business_public_customer_get_datagrid_obj = business_public_customer_get_datagrid.data("zui.datagrid"); //表格对象

    //搜索按钮-----------------------------------------------------------------------------------------------
    business_public_customer_get_search_btn.click(function(){

        //字段整理
        var keyword
        = "?sid="    + business_public_customer_get_tool_keys.val()
        + "&search=" + business_public_customer_get_tool_search.val();

        //GET提交
        zui_datagrid_render(business_public_customer_get_datagrid_obj,business_public_customer_get_api.datagrid+keyword);

    });
    
    //隶属于我按钮-----------------------------------------------------------------------------------------------
    business_public_customer_get_occupy_btn.click(function(){
        
        //数据复原
        common_form_reset();

        //批量取值
        var data_arr = business_public_customer_get_datagrid_obj.getCheckItems().filter(function(e){return e});
        if( data_arr.length>0 ){
            
            //ID获取
            var data_id = [];
            for(var i=0;i<data_arr.length;i++){
                data_id.push(data_arr[i].id);
            }

            //数据赋值
            business_public_customer_get_occupy_submit.attr("dataId",data_id.join(","));

            //面板显示
            business_public_customer_get_occupy_box.modal("show");

        } else {
            um_tip("至少选择一条数据","1000","text-danger");
        }

    });
    //隶属于我提交
    business_public_customer_get_occupy_submit.click(function(){

        //ID取值
        var data_id = $(this).attr("dataId");

        //远程提交
        $.ajax({
            url     : API.test_response,
            type    : "post",
            dataType: "json",
            data    : { 
                id      : data_id
            },
            success : function(data){
                if( data.status>0 ){
                    um_tip(data.message);
                    zui_datagrid_reset(business_public_customer_get_datagrid_obj,business_public_customer_get_api.datagrid,"clear");
                } else {
                    um_tip(data.message,"1500","text-danger");
                }
            }
        });

    });

});//预加载结尾
</script>