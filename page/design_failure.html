<!-- 页面外套 -->
<div class="page-wrapper" id="design_failure">

	<!-- 数据网格 -->
	<div class="datagrid datagrid-striped" id="design_failure_datagrid">
		<!-- 工具条组 -->
		<div class="tool-group">
			<div class="tool-search">
				<div class="im-label">
					<div class="input-group">
						<select class="form-control" id="design_failure_tool_keys">
							<option value="1">项目编号</option>
							<option value="2">项目名称</option>
							<option value="3">设计师</option>
						</select>
						<span class="input-group-addon fix-border fix-padding"></span>
						<input type="text" class="form-control" id="design_failure_tool_search">

					</div>
				</div>
				<label>
					<span>状态：</span>
					<select class="form-control" id="design_failure_tool_select1">
						<option value="0">全部</option>
						<option value="1">未签申请中</option>
						<option value="2">不准申请中</option>
					</select>
				</label>
				<div class="im-label" id="design_failure_tool_date1"><!--JS推进--></div>
				<div class="im-label" id="design_failure_tool_date2"><!--JS推进--></div>
				<label><button class="btn btn-primary" id="design_failure_query_btn">查询</button></label>
				<div class="clearfix"></div>
	</div>
		</div>
		<!-- tool-group -->
		 <div>
		      <div class="datagrid-container"></div>
		      <ul class="pager btn-mini" data-elements="prev,pages,next"></ul>
	     </div>
	<!-- datagrid -->
	<!-- 项目查看盒子 -->
	<div class="modal modal-for-page fade" aria-hidden="false" id="design_failure_show_box">
		<div class="modal-dialog modal-fullscreen">
			<div class="modal-content">
				<div class="modal-header">
					<button class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">关闭</span></button>
					<h4 class="modal-title">项目审批失败</h4>
				</div>
				<div class="modal-body modal-scroll">
					<div class="container">

						<!-- 用户项目进度 -->
						<table class="table table-bordered" id="design_failure_show_t_prog">
							<thead><tr><th>项目进度</th></tr></thead>
							<tbody><!-- JS推进 --></tbody>
						</table>

						<!-- 用户项目信息 -->
						<table class="table table-bordered" id="design_failure_show_t_case">
							<thead>
							<tr>
								<th colspan="2">项目信息
									<button class="btn btn-default btn-mini pull-right um_btn_collapse"><i class="icon icon-angle-up"></i></button>
								</th>
							</tr>
							</thead>
							<tbody>
							<!-- JS推进 -->
							</tbody>
						</table>

						<!-- 用户负责人信息 -->
						<table class="table table-bordered" id="design_failure_show_t_user">
							<thead>
							<tr>
								<th colspan="2">负责人信息
									<button class="btn btn-default btn-mini pull-right um_btn_collapse"><i class="icon icon-angle-up"></i></button>
								</th>
							</tr>
							</thead>
							<tbody>
							<!-- JS推进 -->
							</tbody>
						</table>

						<!-- 用户切换面板-->
						<ul class="nav nav-tabs">
							<li class="active"><a data-tab="" href="#design_failure_show_filelist">项目附件</a></li>
							<li><a data-tab="" href="#design_failure_show_record">操作记录</a></li>
						</ul>
						<div class="tab-content">
							<div class="datagrid datagrid-striped tab-pane active" id="design_failure_show_filelist">
								<!-- 工具条组-->
								<div class="tool-group" style="padding:0;border-top:0">
									<div class="tool-deal" style="padding:5px;">
										<div class="btn-group" data-toggle="buttons" id="design_failure_show_filelist_type">
											<label class="btn btn-mini active"><input type="radio" name="filetype" value="1">商务附件</label>
											<label class="btn btn-mini"><input type="radio" name="filetype" value="2">设计附件</label>
											<label class="btn btn-mini"><input type="radio" name="filetype" value="3">施工图</label>
											<label class="btn btn-mini"><input type="radio" name="filetype" value="4">效果图</label>
											<label class="btn btn-mini"><input type="radio" name="filetype" value="5">报价附件</label>
											<label class="btn btn-mini"><input type="radio" name="filetype" value="6">合同附件</label>
										</div>
										<div class="clearfix"></div>
									</div>
								</div>
								<!-- tool-group -->
								<div class="datagrid-container"></div>
								<ul class="pager btn-mini" data-elements="prev,pages,next"></ul>
							</div>
							<div class="datagrid datagrid-striped tab-pane" id="design_failure_show_record">
								<div class="datagrid-container"></div>
								<ul class="pager btn-mini" data-elements="prev,pages,next"></ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- design_failure_show_box -->

	<!--洽谈等级盒子 -->
	<div class="modal modal-for-page fade" aria-hidden="false" id="design_failure_great_box">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">关闭</span></button>
					<h4 class="modal-title">洽谈等级</h4>
				</div>
				<div class="modal-body">
					<form class="container form-horizontal">
						<div class="form-group require">
							<label class="col-sm-2 required" for="design_failure_great_level">洽谈等级</label>
							<div class="col-sm-8"><select class="form-control" id="design_failure_great_level"><!--JS推进--></select></div>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
					<button type="button" class="btn btn-primary" id="design_failure_great_submit">提交</button>
				</div>
			</div>
		</div>
	</div>
	<!-- design_failure_great_box -->

	<!-- 日志查看盒子 -->
	<div class="modal modal-for-page fade" aria-hidden="false" id="design_failure_logShow_box">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">关闭</span></button>
					<h4 class="modal-title">日志查看</h4>
				</div>
				<div class="modal-body modal-scroll">
					<div class="container comments">
						<!-- JS推进 -->
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- design_failure_logShow_box -->
	<!-- 分单盒子 -->
	<div class="modal modal-for-page fade" aria-hidden="false" id="desing_failure_reinsurance">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">关闭</span></button>
					<h4 class="modal-title">分单</h4>
				</div>
				<div class="modal-body">
					<form class="container form-horizontal">
						<div class="form-group">
							<div class="form-group">
								<label class="col-sm-2 required" for="desing_failure_user">设计师</label>
								<div class="col-sm-8">
									<select class="form-control" id="desing_failure_user"><!-- JS推进 --></select>
								</div>
							</div>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
					<button type="button" class="btn btn-primary" id="desing_failure_submit">提交</button>
				</div>
			</div>
		</div>
	</div>
	<!-- desing_failure_reinsurance -->

	<!-- 打回盒子 -->
	<div class="modal modal-for-page fade" aria-hidden="false" id="design_failure_back_box">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">关闭</span></button>
					<h4 class="modal-title">打回</h4>
				</div>
				<div class="modal-body">
					<p class="text-danger"><i class="icon icon-warning-sign"></i> 是否打回？</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
					<button type="button" class="btn btn-danger" id="design_failure_back_submit">提交</button>
				</div>
			</div>
		</div>
	</div>
	<!-- design_failure_back_box -->

</div>
<!-- page-wrapper -->
<script>
	$(function() {
		//变量声明-----------------------------------------------------------------------------------------------
		var
				design_failure = $("#design_failure"), //页面ID
				design_failure_datagrid = $("#design_failure_datagrid"), //数据表格
				//搜索
				design_failure_tool_keys = $("#design_failure_tool_keys"), //搜索类别
				design_failure_tool_search = $("#design_failure_tool_search"), //搜索字段
				design_failure_tool_select1 = $("#design_failure_tool_select1"), //下拉选择1
				design_failure_query_btn     = $("#design_failure_query_btn"), //查找按钮
				//查看
				design_failure_show_box = $("#design_failure_show_box"), //查看盒子
				design_failure_show_t_prog = $("#design_failure_show_t_prog"), //项目进度
				design_failure_show_t_case = $("#design_failure_show_t_case"), //项目信息
				design_failure_show_t_user = $("#design_failure_show_t_user"), //负责人信息
				design_failure_show_filelist = $("#design_failure_show_filelist"), //项目附件
				design_failure_show_filelist_type = $("#design_failure_show_filelist_type"), //项目附件类型
				design_failure_show_record = $("#design_failure_show_record"), //操作记录
				//洽谈等级
				design_failure_great_box = $("#design_failure_great_box"), //洽谈盒子
				design_failure_great_submit = $("#design_failure_great_submit"), //洽谈提交
				design_failure_great_level = $("#design_failure_great_level"), //洽谈等级
				//跟踪日志
				design_failure_logShow_box = $("#design_failure_logShow_box"), //日志查看盒子
				design_failure_logAdd_date = $("#design_failure_logAdd_date"), //洽谈等级
				design_failure_logAdd_prog =$("#design_failure_logAdd_prog"), //项目进度
				design_failure_logAdd_painter =$("#design_failure_logAdd_painter"),//绘图员
		       //分单
				desing_failure_reinsurance  = $("#desing_failure_reinsurance"),   //分单盒子
				desing_failure_submit       = $("#desing_failure_submit"),        //分单提交
				desing_failure_user         = $("#desing_failure_user"),          //分单设计师
				//打回
				design_failure_back_box            = $("#design_failure_back_box"),             //打回盒子
				design_failure_back_submit         = $("#design_failure_back_submit"),          //打回提交

				design_failure_assign_btn       = ".design_failure_assign_btn",                       //分单按钮
				design_failure_back_btn         = ".design_failure_back_btn";                     //打回按钮

		//接口对象-----------------------------------------------------------------------------------------------
		if (window.STATE == "local") {
			//本地接口
			var design_failure_api = {
				datagrid: LOCAL + "Test/test_datagrid.json", //数据表格
				datagrid_filelist: LOCAL + "Test/Business/customer_filelist.json", //项目附件表格
				datagrid_record: LOCAL + "Test/test_datagrid.json", //操作记录表格
				select: LOCAL + "Test/test_select.json", //下拉选择
				select_level: LOCAL + "Test/Design/admin_level.json", //下拉选择(等级)
				modal_show: LOCAL + "Test/Business/customer_edit.json", //查看盒子
				topic: LOCAL + "Test/Business/provider_topic.json", //日志查看
				design: LOCAL + "Test/Design/admin_design.json", //日志查看
			}


		} else if (window.STATE == "route") {}

		//数据表格-----------------------------------------------------------------------------------------------
		design_failure_datagrid.datagrid({
			height: zui_datagrid_height(design_failure_datagrid),
			sortable: false,
			cache: false,
			showRowIndex: true,
			checkable: false,
			checkByClickRow: false,
			selectable: false,
			configs: {
				R0: {
					className: "text-center"
				},
				C1: {
					className: "cell-hidden"
				}
			},
			states: {
				pager: {
					page: 1,
					recPerPage: window.REC_PER_PAGE,
				}
			},
			dataSource: {
				cols: [{name: "id",label: "ID",width: 49},
					{name: "date",label: "分单时间",width: 100},
					{name: "username",label: "项目编号",width: 100},
					{name: "text8",label: "项目名称",width: 150,
					html: true,
						valueOperator: {
							getter: function(dataValue, cell) {
								return `<a class="design_failure_show_btn" rowIndex="${cell.rowIndex}">${dataValue}</a>`;
							}
						}
					},
					{name: "tex10",label: "项目状态",width: 150},
					{name: "name",label: "项目联系人",width: 100},
					{name: "text2",label: "面积",width: 100},
					{name: "name",label: "项目状态",width: 100},
					{name: "text6",label: "项目地址",width: 100},
					{name: "name",label: "量房",width: 100},
					{name: "name",label: "设计进度",width: 100},
					{name: "level",label: "洽谈等级",width: 80,
					html: true,
						valueOperator: {
							getter: function(dataValue, cell) {
								var level = "";
								switch (dataValue) {
									case 1:
										level = "A";
										break;
									case 2:
										level = "B";
										break;
									case 3:
										level = "C";
										break;
									case 4:
										level = "D";
										break;
									case 5:
										level = "E";
										break;
									case 6:
										level = "F";
										break;
								}
								return `<a class="design_failure_great_btn" rowIndex="${cell.rowIndex}" rowLevel="${dataValue}">${level}</a>
					       `;
							}
						}
					},
					{name: "name",label: "量房",width: 100},
					{name: "name",label: "项目预算",width: 100},
					{name: "name",label: "业务员",width: 100},
					{name: "name",label: "设计师",width: 100},
					{name: "date",label: "剩余回访时间",width: 100},
					{name: "log",label: "跟踪日志",width: 80,
					html: true,
						valueOperator: {
							getter: function(dataValue, cell) {
								return `
                            <a class="design_failure_logShow_btn" rowIndex="${cell.rowIndex}">查看</a>`;
							}
						}
					},
					{name:"state",  label:"操作",width:180,
						html:true,
						valueOperator : {
							getter : function(dataValue,cell){
								var data = cell.config.data;
								return `
                             <a class="design_failure_assign_btn" rowIndex="${cell.rowIndex}">分单</a>
                             <a class="design_failure_back_btn"   rowIndex="${cell.rowIndex}">打回</a>
                            `;
							}
						}
					}

				],
				remote: function() {
					return {
						url: design_failure_api.datagrid,
						type: "POST",
						dataType: "json",
					}
				}
			}
		});
		//查看表格-项目附件
		design_failure_show_filelist.datagrid({
			height: "page",
			rowDefaultHeight: 72,
			sortable: false,
			cache: false,
			showRowIndex: true,
			configs: {
				R0: {
					className: "text-center"
				},
				C1: {
					className: "cell-hidden"
				},
				C7: {
					className: "text-center"
				},
			},
			states: {
				pager: {
					page: 1,
					recPerPage: 10,
				}
			},
			dataSource: {
				cols: [{
					name: "id",
					label: "ID",
					width: 49
				},
					{
						name: "thumb",
						label: "缩略图",
						width: 70,
						html: true,
						valueOperator: {
							getter: function(dataValue, cell) {
								var file_thumb = "";
								if (dataValue.thumb_icon == "image") {
									file_thumb = `<img src="${dataValue.thumb_path}">`
								} else if (dataValue.thumb_icon == "file") {
									file_thumb = `<i style="font-size:50px!important;" class="icon icon-file-o"></i>`;
								} else {
									file_thumb = `<i style="font-size:50px!important;" class="icon icon-file-${dataValue.thumb_icon}"></i>`;
								}
								return file_thumb;
							}
						}
					},
					{
						name: "name",
						label: "附件名称",
						width: 300
					},
					{
						name: "type",
						label: "类型",
						width: 80
					},
					{
						name: "uploader",
						label: "上传者",
						width: 80
					},
					{
						name: "date",
						label: "上传时间",
						width: 140
					},
					{
						name: "path",
						label: "导出/下载",
						width: 80,
						html: true,
						valueOperator: {
							getter: function(dataValue, cell) {
								return `<a target="_blank" href="${dataValue}"><i class="icon icon-download-alt"></i></a>`;
							}
						}
					}
				],
				remote: function() {
					return {
						url: design_failure_api.datagrid_filelist,
						type: "POST",
						dataType: "json",
					}
				}
			}
		});
		//查看表格-操作记录
		design_failure_show_record.datagrid({
			height: "page",
			sortable: false,
			cache: false,
			showRowIndex: true,
			configs: {
				R0: {
					className: "text-center"
				},
				C1: {
					className: "cell-hidden"
				}
			},
			states: {
				pager: {
					page: 1,
					recPerPage: window.REC_PER_PAGE,
				}
			},
			dataSource: {
				cols: [{
					name: "id",
					label: "ID",
					width: 49
				},
					{
						name: "name",
						label: "操作人",
						width: 80
					},
					{
						name: "object",
						label: "日志",
						width: 240,
						html: true,
						valueOperator: {
							getter: function(dataValue, cell, datagrid) {
								var temp = "";
								if (dataValue.state == 1) {
									temp = `<span class="text-danger">${dataValue.text}</span>`;
								} else {
									temp = `<span class="text-success">${dataValue.text}</span>`;
								}
								return temp;
							}
						}
					},
					{
						name: "date",
						label: "时间",
						width: 140
					},
				],
				remote: function() {
					return {
						url: design_failure_api.datagrid_record,
						type: "POST",
						dataType: "json",
					}
				}
			}
		});

		//变量声明-----------------------------------------------------------------------------------------------
		var
				design_failure_datagrid_obj = design_failure_datagrid.data("zui.datagrid"), //表格对象
				design_failure_show_filelist_obj = design_failure_show_filelist.data("zui.datagrid"), //查看表格1
				design_failure_show_record_obj = design_failure_show_record.data("zui.datagrid"), //查看表格2
				design_failure_show_btn = ".design_failure_show_btn", //查看按钮
				design_failure_great_btn = ".design_failure_great_btn", //洽谈等级按钮
				design_failure_logShow_btn = ".design_failure_logShow_btn", //日志查看
				design_failure_logAdd_btn = ".design_failure_logAdd_btn"; //日志添加

		//上传创建-----------------------------------------------------------------------------------------------
		zui_upload_group({
			upid: "design_failure_logAdd_file",
			type: "img",
			maxSize: "10mb"
		});
		//下拉选项-----------------------------------------------------------------------------------------------
		//洽谈等级(面板)
		$.ajax({
			url: design_failure_api.select_level,
			type: "post",
			dataType: "json",
			data: {},
			success: function(data) {
				if (data.status > 0) {
					var data = data.data;
					var option = "";
					for (var i = 0; i < data.length; i++) {
						option += "<option value='" + data[i].id + "'>" + data[i].name + "</option>"
					}
					design_failure_great_level.html(option);

				}
			}
		});
		//日志时间
		$.ajax({
			url: design_failure_api.select,
			type: "post",
			dataType: "json",
			data: {},
			success: function(data) {
				if (data.status > 0) {
					var data = data.data;
					var option = "";
					for (var i = 0; i < data.length; i++) {
						option += "<option value='" + data[i].id + "'>" + data[i].name + "</option>"
					}
					design_failure_logAdd_date.html(option);
				}
			}
		});
//		分单
		$.ajax({
			url     : design_failure_api.select,
			type    : "post",
			dataType: "json",
			data    : {},
			success : function(data){
				if( data.status>0 ){
					var data = data.data;
					var option = "";
					for(var i=0;i<data.length;i++){
						option += "<option value='"+data[i].id+"'>"+data[i].name+"</option>"
					}
					desing_failure_user.html(option);
				}
			}
		});



		//搜索按钮-----------------------------------------------------------------------------------------------
		design_failure_query_btn.click(function() {

			//字段整理
			var keyword = "?sid=" + design_failure_tool_keys.val() +
					"&search=" + design_failure_tool_search.val() +
					"&state=" + design_failure_tool_select1.val()
					
			//GET提交
			zui_datagrid_render(design_failure_datagrid_obj, design_failure_api.datagrid + keyword);

		});
		//查看按钮-----------------------------------------------------------------------------------------------
		$(document).on("click", design_failure_show_btn, function() {

			//数据ID
			var data_id = zui_datagrid_get_id($(this).attr("rowIndex"));

			//远程提交
			$.ajax({
				url: design_failure_api.modal_show,
				type: "post",
				dataType: "json",
				data: {
					id: data_id
				},
				success: function(data) {
					if (data.status > 0) {

						//查看模板
						var data = data.data;

						//项目进度
						var temp_prog = `<tr><td><ul class="bussiness-prog-group flex-box">`;
						var temp_prog_state_class = "bg-primary";
						for (var i = 0; i < data.prog.length; i++) {
							if (data.prog[i].state == 0) {
								temp_prog_state_class = "bg-grey"
							}
							temp_prog +=
									`
                            <li class="flex-son text-center">
                                <b class="${temp_prog_state_class}">${i+1}</b>
                                <div class="small">${data.prog[i].name}</div>
                                <div class="small">${data.prog[i].date}</div>
                            </li>
                        `;
						}
						design_failure_show_t_prog.find("tbody").html(temp_prog + "</ul></td></tr>");

						//项目信息
						var temp_case =
								`
                        <tr><td style="width:120px;">项目编号</td><td>${data.number}</td></tr>
                        <tr><td>项目名称  </td><td>${data.case}         </td></tr>
                        <tr><td>项目状态  </td><td>${data.state}        </td></tr>
                        <tr><td>申请理由  </td><td>${data.reason}       </td></tr>
                        <tr><td>装修面积  </td><td>${data.decoarea} ㎡  </td></tr>
                        <tr><td>房源状态  </td><td>${data.statename}    </td></tr>
                        <tr><td>装修地址  </td><td>${data.decoaddr}     </td></tr>
                        <tr><td>联系人1   </td><td>${data.user1}        </td></tr>
                        <tr><td>手机1     </td><td>${data.tel1}         </td></tr>
                        <tr><td>联系人2   </td><td>${data.user2}        </td></tr>
                        <tr><td>手机2     </td><td>${data.tel2}         </td></tr>
                        <tr><td>办公地址  </td><td>${data.addr}         </td></tr>
                        <tr><td>办公电话  </td><td>${data.tel0}         </td></tr>
                        <tr><td>信息员    </td><td>${data.providername} </td></tr>
                        <tr><td>房屋类型  </td><td>${data.housetypename}</td></tr>
                        <tr><td>装修意向  </td><td>${data.housetodoname}</td></tr>
                        <tr><td>装修服务  </td><td>${data.houseservname}</td></tr>
                        <tr><td>交房日期  </td><td>${data.housedate1}   </td></tr>
                        <tr><td>期望完工  </td><td>${data.housedate2}   </td></tr>
                        <tr><td>对手数量  </td><td>${data.rivalnumb}    </td></tr>
                        <tr><td>对手进展  </td><td>${data.rivalstepname}</td></tr>
                        <tr><td>备注      </td><td>${data.text}         </td></tr>
                    `;
						design_failure_show_t_case.find("tbody").html(temp_case);

						//负责人信息
						var temp_user =
								`
                        <tr><td style="width:120px;">业务员</td><td>${data.salesman}</td></tr>
                        <tr><td>设计师      </td><td>${data.designer}   </td></tr>
                        <tr><td>效果图绘图员</td><td>${data.sketcher}   </td></tr>
                        <tr><td>施工图绘图员</td><td>${data.draftsman}  </td></tr>
                        <tr><td>预算员      </td><td>${data.budgetor}   </td></tr>
                        <tr><td>工程监理    </td><td>${data.supervision}</td></tr>
                        <tr><td>项目经理    </td><td>${data.manager}    </td></tr>
                    `;
						design_failure_show_t_user.find("tbody").html(temp_user);

						//数据表格
						zui_datagrid_render(design_failure_show_filelist_obj, design_failure_api.datagrid_filelist + "?id=" + data_id +
								"&type=1");
						zui_datagrid_render(design_failure_show_record_obj, design_failure_api.datagrid_record + "?id=" + data_id);

						design_failure_show_filelist_type.attr("rowIndex", data_id); //ID赋值
						design_failure_show_box.modal("show"); //盒子显示
					} else {
						um_tip(data.message, "1500", "text-danger");
					}
				}
			});

		});
		//项目附件筛选
		design_failure_show_filelist_type.find(".btn").click(function() {

			//字段整理
			var keyword =
					"?id=" + design_failure_show_filelist_type.attr("rowIndex") +
					"&type=" + $(this).find("input").val();

			zui_datagrid_render(design_failure_show_filelist_obj, design_failure_api.datagrid_filelist + keyword);
		});

		//洽谈等级-----------------------------------------------------------------------------------------
		$(document).on("click", design_failure_great_btn, function() {

			//数据取值
			var data_id = $(this).attr("rowIndex");
			var rowLevel = $(this).attr("rowLevel");

			//数据赋值
			design_failure_great_submit.attr("dataId", data_id);
			design_failure_great_level.val(rowLevel);

			//面板显示
			design_failure_great_box.modal("show");

		});
		//洽谈等级-提交
		design_failure_great_submit.click(function() {
			//数据ID
			var data_id = $(this).attr("dataId");
			//远程提交
			$.ajax({
				url: API.test_response,
				type: "post",
				dataType: "json",
				data: {
					id: data_id,
					level: design_failure_great_level.val()
				},
				success: function(data) {
					if (data.status > 0) {
						um_tip(data.message);
						zui_datagrid_reset(design_failure_datagrid_obj, design_failure_api.datagrid);

					} else {
						um_tip(data.message, "1500", "text-danger");
						console.log(data.message)
					}
				}
			});

		});
		//项目进度
		$.ajax({
			url     : design_failure_api.design,
			type    : "post",
			dataType: "json",
			data    : {},
			success : function(data){
				if( data.status>0 ){
					var data = data.data;
					var option = "";
					var option = "";
					for(var i=0;i<data.length;i++){
						option += "<option value='"+data[i].id+"'>"+data[i].name+"</option>"
					}
					design_failure_logAdd_prog.html(option);
				}
			}
		});
		//绘图员
		$.ajax({
			url     : design_failure_api.select,
			type    : "post",
			dataType: "json",
			data    : {},
			success : function(data){
				if( data.status>0 ){
					var data = data.data;
					var option = "";
					for(var i=0;i<data.length;i++){
						option += "<option value='"+data[i].id+"'>"+data[i].name+"</option>"
					}
					design_failure_logAdd_painter.html(option);
				}
			}
		});
		//日志查看-----------------------------------------------------------------------------------------------
		$(document).on("click", design_failure_logShow_btn, function() {

			//数据复原
			common_topic_answer_reset();

			//ID取值
			var data_id = $(this).attr("rowIndex");

			//远程提交
			$.ajax({
				url: design_failure_api.topic,
				type: "post",
				dataType: "json",
				data: {
					id: data_id,
				},
				success: function(data) {

					if (data.status > 0) {

						//变量赋值
						var data = data.data;
						var temp = "";

						//一级话题
						for (var i = 0; i < data.length; i++) {
							temp +=
									`
                            <div class="comments-list">
                                <div class="comment">
                                    <div class="avatar text-center">
                                        <i class="icon-user icon-2x text-primary"></i>
                                        <div class="small text-primary">${data[i].user}</div>
                                    </div>
                                    <div class="content">
                                        <div class="pull-right text-muted">${data[i].date}</div>
                                        <div class="text"><span class="label label-outline label-primary design-log-prog">${data[i].prog}</span> ${data[i].text}</div>
                                        <div class="text">${data[i].text}</div>
                                        <div class="actions common_topic_imgs_wrap">
                                            <a class="common_topic_imgs_btn">图片[${data[i].imgs.length}]</a>
                                            <div class="common_topic_imgs_box hide">`;

							//图片循环
							for (var m = 0; m < data[i].imgs.length; m++) {
								temp +=
										`<a class="ov1" target="_blank" href=${FILE_PATH}${data[i].imgs[m].path}>${data[i].imgs[m].name}</a>`;
							}

							//标签收尾
							temp += `</div></div></div>`;

							//评论嵌套
							for (var j = 0; j < data[i].childTopic.length; j++) {
								temp +=
										`
                                <div class="comments-list">
                                    <div class="comment">
                                        <div class="content">
                                            <div class="pull-right text-muted">10-20 11:00</div>
                                            <div><b>${data[i].childTopic[j].user}</b></div>
                                            <div class="text">${data[i].childTopic[j].text}</div>
                                        </div>
                                    </div>
                                </div>`;
							}

							//标签收尾
							temp +=
									`
                        <div class="comments-list comments-list-for-answer">
                            <div class="actions">
                                <a class="common_topic_answer_btn">回复</a>
                                <div class="hide common_topic_answer_text_wrap">
                                    <textarea class="form-control common_topic_answer_text"></textarea>
                                    <button type="button" class="pull-right btn btn-mini btn-primary design_failure_logShow_submit" data-tid="${data[i].id}" style="margin-top:5px;">提交</button>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                        </div>
                        </div></div>`;
						}

						//文本推进
						design_failure_logShow_box.find(".comments").html(temp);

						//ID赋值
						design_failure_logShow_box.attr("rowIndex", data_id);

						//面板显示
						design_failure_logShow_box.modal("show");

					} else {
						um_tip(data.message, "1500", "text-danger");
					}
				}
			});

		});

		//分单按钮-----------------------------------------------------------------------------------------------
				$(document).on("click",design_failure_assign_btn,function(){

					//数据复原
					common_form_reset();

					//数据取值
					var data_id = $(this).attr("rowIndex");

					//数据赋值
					desing_failure_submit.attr("dataId",data_id);

					//面板显示
					desing_failure_reinsurance.modal("show");

				});
		//分单提交
		desing_failure_submit.click(function(){

			//数据ID
			var data_id = $(this).attr("dataId");

			//远程提交
			$.ajax({
				url     : API.test_response,
				type    : "post",
				dataType: "json",
				data    : {
					id   : data_id,
					user  : desing_failure_user.val()
				},
				success : function(data){
					if( data.status>0 ){
						um_tip(data.message);
						zui_datagrid_reset(design_failure_datagrid_obj,design_failure_api.datagrid);
					} else {
						um_tip(data.message,"1500","text-danger");
					}
				}
			});

		});

		//打回按钮-----------------------------------------------------------------------------------------------
		$(document).on("click",design_failure_back_btn,function(){

			//数据取值
			var data_id = $(this).attr("rowIndex");

			//数据赋值
			design_failure_back_submit.attr("dataId",data_id);

			//面板显示
			design_failure_back_box.modal("show");

		});
		//打回提交
		design_failure_back_submit.click(function(){

			//数据ID
			var data_id = $(this).attr("dataId");

			//远程提交
			$.ajax({
				url     : API.test_response,
				type    : "post",
				dataType: "json",
				data    : { id: data_id },
				success : function(data){
					if( data.status>0 ){
						um_tip(data.message);
						zui_datagrid_reset(design_failure_datagrid_obj,design_failure_api.datagrid);
					} else {
						um_tip(data.message,"1500","text-danger");
					}
				}
			});
		});
	}); //预加载结尾
</script>

<style>
	#design_failure .tool-group input[readonly] {
		width: 67px !important;
	}
</style>
