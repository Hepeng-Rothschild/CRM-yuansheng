<!-- 页面外套 -->
<div class="page-wrapper" id="business_customer_admin">

    <!-- 数据网格 -->
    <div class="datagrid datagrid-striped" id="business_customer_admin_datagrid">

        <!-- 工具条组 -->
        <div class="tool-group">
            <div class="tool-search">
                <div class="im-label">
                    <div class="input-group">
                        <select class="form-control" id="business_customer_admin_tool_keys">
                            <option value="1">项目编号</option>
                            <option value="2">项目名称</option>
                            <option value="3">信息员</option>
                            <option value="4">业务员</option>
                            <option value="5">设计师</option>
                            <option value="6">项目联系人</option>
                            <option value="7">联系电话</option>
                        </select>
                        <span class="input-group-addon fix-border fix-padding"></span>
                        <input type="text" class="form-control" id="business_customer_admin_tool_search">
                    </div>
                </div>
                <label>
                    <span>项目状态：</span>
                    <select class="form-control" id="business_customer_admin_tool_select1" style="width:160px!important;">
                        <option value="0">全部</option>
                        <option value="1">正跟琮</option>
                        <option value="2">已提交-商务经未审批</option>
                        <option value="3">已提交-设计经理未分单</option>
                        <option value="4">在谈</option>
                        <option value="5">已签</option>
                        <option value="6">未签申请中</option>
                        <option value="7">未签已归库</option>
                        <option value="8">不准申请中</option>
                        <option value="9">不准已归库</option>
                        <option value="10">已放弃</option>
                    </select>
                </label>
                <label><button class="btn btn-primary" id="business_customer_admin_search_btn"><i class="icon icon-search"></i> 搜索</button></label>
                <div class="clearfix"></div>
            </div>
            <div class="tool-deal">
                <label><button class="btn btn-primary" id="business_customer_admin_turnSalesman_btn">   <i class="icon icon-exchange"></i> 转移客户</button></label>
                <label><button class="btn btn-primary" id="business_customer_admin_aban_btn">   <i class="icon icon-inbox"></i> 放弃客户</button></label>
                <label><button class="btn btn-primary" id="business_customer_admin_change_btn"> <i class="icon icon-signin"></i> 客户交接</button></label>
                <label><button class="btn btn-primary" id="business_customer_admin_export_btn"> <i class="icon icon-external-link"></i> 导出项目单</button></label>
                <div class="clearfix"></div>
            </div>
        </div>
        <!-- tool-group -->

        <div class="datagrid-container"></div>
        <ul class="pager btn-mini" data-elements="prev,pages,next"></ul>
    </div>
    <!-- datagrid -->

    <!-- 放弃客户盒子 -->
    <div class="modal modal-for-page fade" aria-hidden="false" id="business_customer_admin_aban_box">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">关闭</span></button>
                    <h4 class="modal-title">放弃客户</h4>
                </div>
                <div class="modal-body">
                    <form class="container form-horizontal">
                        <div class="form-group">
                            <label class="col-sm-2 required" for="business_customer_admin_aban_type">放弃理由</label>
                            <div class="col-sm-8">
                                <select class="form-control" id="business_customer_admin_aban_type">
                                    <option value="1">有价值</option>
                                    <option value="2">无价值</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 required" for="business_customer_admin_aban_reason">理由详情</label>
                            <div class="col-sm-8">
                                <textarea class="form-control" id="business_customer_admin_aban_reason"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-danger" id="business_customer_admin_aban_submit">提交</button>
                </div>                
            </div>
        </div>
    </div>
    <!-- business_customer_admin_aban_box -->

    <!-- 客户交接盒子 -->
    <div class="modal modal-for-page fade" aria-hidden="false" id="business_customer_admin_change_box">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">关闭</span></button>
                    <h4 class="modal-title">客户交接</h4>
                </div>
                <div class="modal-body">
                    <form class="container form-horizontal">
                        <div class="form-group">
                            <label class="col-sm-2 required">离职人员</label>
                            <div class="col-sm-8"><input type="text" class="form-control salesman_person_btn" id="business_customer_admin_turn_quit" readonly></div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 required">目标人员</label>
                            <div class="col-sm-8"><input type="text" class="form-control salesman_person_btn" id="business_customer_admin_turn_target" readonly></div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2"></label>
                            <div class="col-sm-8 form-control-static">注：业务人员客户交接。是指将“离职人员”名下所有“正跟踪”和“在谈”客户转到“目标人员”名下</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" id="business_customer_admin_change_submit">提交</button>
                </div>                
            </div>
        </div>
    </div>
    <!-- business_customer_admin_change_box -->

    <!-- 转移客户盒子 -->
    <div class="modal modal-for-page fade" aria-hidden="false" id="business_customer_admin_turnSalesman_box">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">关闭</span></button>
                    <h4 class="modal-title">转移客户的商务专员</h4>
                </div>
                <div class="modal-body">
                    <form class="container form-horizontal">
                        <div class="form-group">
                            <label class="col-sm-2 required">项目编号</label>
                            <div class="col-sm-8"><input type="text" class="form-control" id="business_customer_admin_turnSalesman_item" readonly></div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 required">原商务专员</label>
                            <div class="col-sm-8"><input type="text" class="form-control" id="business_customer_admin_turnSalesman_pre" readonly></div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 required">新商务专员</label>
                            <div class="col-sm-8"><input type="text" class="form-control salesman_person_btn" id="business_customer_admin_turnSalesman_now" readonly></div>
                        </div>                      
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" id="business_customer_admin_turnSalesman_submit">提交</button>
                </div>                
            </div>
        </div>
    </div>
    <!-- business_customer_admin_turnSalesman_box -->

    <!-- 转移信息员盒子 -->
    <div class="modal modal-for-page fade" aria-hidden="false" id="business_customer_admin_turnProvider_box">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">关闭</span></button>
                    <h4 class="modal-title">转移客户的信息员</h4>
                </div>
                <div class="modal-body">
                    <form class="container form-horizontal">
                        <div class="form-group">
                            <label class="col-sm-2 required">项目编号</label>
                            <div class="col-sm-8"><input type="text" class="form-control" id="business_customer_admin_turnProvider_item" readonly></div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 required">原信息员</label>
                            <div class="col-sm-8"><input type="text" class="form-control" id="business_customer_admin_turnProvider_pre"  readonly></div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 required">新信息员</label>
                            <div class="col-sm-8"><input type="text" class="form-control provider_person_btn" id="business_customer_admin_turnProvider_now" readonly></div>
                        </div>                      
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" id="business_customer_admin_turnProvider_submit">提交</button>
                </div>                
            </div>
        </div>
    </div>
    <!-- business_customer_admin_turnProvider_box -->

    <!-- 转为信息员盒子 -->
    <div class="modal modal-for-page fade" aria-hidden="false" id="business_customer_admin_tobeprovider_box">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">关闭</span></button>
                    <h4 class="modal-title">转为信息员</h4>
                </div>
                <div class="modal-body">
                    <form class="container form-horizontal">
                         <p>您确定要转为信息员吗？转为后将不能看见此客户记录！</p>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" id="business_customer_admin_tobeprovider_submit">提交</button>
                </div>                
            </div>
        </div>
    </div>
    <!-- business_customer_admin_tobeprovider_box -->

    <!-- 人员选择盒子-商务专员 -->
    <div class="modal modal-for-page fade" aria-hidden="false" id="business_customer_admin_salesman_box">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">关闭</span></button>
                    <h4 class="modal-title">商务专员选择</h4>
                </div>
                <div class="modal-body no-padding">

                    <!-- 数据网格 -->
                    <div class="datagrid datagrid-striped" id="business_customer_admin_salesman_datagrid">

                        <!-- 工具条组 -->
                        <div class="tool-group no-padding">
                            <div class="tool-deal" style="border:none;">
                                <label>
                                    <span>姓名：</span>
                                    <input type="text" class="form-control" id="business_customer_admin_salesman_user">
                                </label>
                                <label>
                                    <span>部门：</span>
                                    <select class="form-control" id="business_customer_admin_salesman_depart"><!-- JS推进 --></select>
                                </label>
                                <label><button class="btn btn-primary" id="business_customer_admin_salesman_search_btn">搜索</button></label>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                        <!-- tool-group -->
                        <div class="datagrid-container"></div>
                        <ul class="pager btn-mini" data-elements="prev,pages,next"></ul>
                    </div>
                    <!-- datagrid -->

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" id="business_customer_admin_salesman_submit">提交</button>
                </div>
            </div>
        </div>
    </div>
    <!-- business_customer_admin_salesman_box -->

    <!-- 人员选择盒子-信息员 -->
    <div class="modal modal-for-page fade" aria-hidden="false" id="business_customer_admin_provider_box">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">关闭</span></button>
                    <h4 class="modal-title">信息员选择</h4>
                </div>
                <div class="modal-body no-padding">

                    <!-- 数据网格 -->
                    <div class="datagrid datagrid-striped" id="business_customer_admin_provider_datagrid">

                        <!-- 工具条组 -->
                        <div class="tool-group no-padding">
                            <div class="tool-deal" style="border:none;">
                                <label>
                                    <span>姓名：</span>
                                    <input type="text" class="form-control" id="business_customer_admin_provider_user">
                                </label>
                                <label><button class="btn btn-primary" id="business_customer_admin_provider_search_btn">搜索</button></label>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                        <!-- tool-group -->
                        <div class="datagrid-container"></div>
                        <ul class="pager btn-mini" data-elements="prev,pages,next"></ul>
                    </div>
                    <!-- datagrid -->

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" id="business_customer_admin_provider_submit">提交</button>
                </div>
            </div>
        </div>
    </div>
    <!-- business_customer_admin_provider_box -->

</div>
<!-- page-wrapper -->

<script>
$(function(){

    //变量声明-----------------------------------------------------------------------------------------------
    var 
    business_customer_admin                     = $("#business_customer_admin"),                      //页面ID
    business_customer_admin_datagrid            = $("#business_customer_admin_datagrid"),             //数据表格
    //搜索
    business_customer_admin_tool_keys           = $("#business_customer_admin_tool_keys"),            //搜索类别
    business_customer_admin_tool_search         = $("#business_customer_admin_tool_search"),          //搜索字段
    business_customer_admin_tool_select1        = $("#business_customer_admin_tool_select1"),         //下拉选择1
    business_customer_admin_search_btn          = $("#business_customer_admin_search_btn"),           //搜索按钮
    //批量-放弃
    business_customer_admin_aban_box            = $("#business_customer_admin_aban_box"),             //放弃盒子
    business_customer_admin_aban_btn            = $("#business_customer_admin_aban_btn"),             //放弃按钮
    business_customer_admin_aban_submit         = $("#business_customer_admin_aban_submit"),          //放弃提交
    business_customer_admin_aban_type           = $("#business_customer_admin_aban_type"),            //放弃类型
    business_customer_admin_aban_reason         = $("#business_customer_admin_aban_reason"),          //放弃理由
    //批量-客户交接
    business_customer_admin_change_box          = $("#business_customer_admin_change_box"),           //交接盒子
    business_customer_admin_change_btn          = $("#business_customer_admin_change_btn"),           //交接按钮
    business_customer_admin_change_submit       = $("#business_customer_admin_change_submit"),        //交接提交
    business_customer_admin_turn_quit           = $("#business_customer_admin_turn_quit"),            //离职人员
    business_customer_admin_turn_target         = $("#business_customer_admin_turn_target"),          //目标人员
    //导出项目单
    business_customer_admin_export_btn          = $("#business_customer_admin_export_btn"),           //导出按钮
    //批量-转移客户
    business_customer_admin_turnSalesman_btn    = $("#business_customer_admin_turnSalesman_btn"),     //转移商务按钮
    business_customer_admin_turnSalesman_box    = $("#business_customer_admin_turnSalesman_box"),     //转移商务盒子
    business_customer_admin_turnSalesman_submit = $("#business_customer_admin_turnSalesman_submit"),  //转移商务提交
    business_customer_admin_turnSalesman_item   = $("#business_customer_admin_turnSalesman_item"),    //转移商务项目
    business_customer_admin_turnSalesman_pre    = $("#business_customer_admin_turnSalesman_pre"),     //转移商务原来
    business_customer_admin_turnSalesman_now    = $("#business_customer_admin_turnSalesman_now"),     //转移商务现在    
    //操作-转移信息员
    business_customer_admin_turnProvider_box    = $("#business_customer_admin_turnProvider_box"),     //转移信息员盒子
    business_customer_admin_turnProvider_submit = $("#business_customer_admin_turnProvider_submit"),  //转移信息员提交
    business_customer_admin_turnProvider_item   = $("#business_customer_admin_turnProvider_item"),    //转移信息员项目
    business_customer_admin_turnProvider_pre    = $("#business_customer_admin_turnProvider_pre"),     //转移信息员原来
    business_customer_admin_turnProvider_now    = $("#business_customer_admin_turnProvider_now"),     //转移信息员现在
    //操作-转为信息员
    business_customer_admin_tobeprovider_box    = $("#business_customer_admin_tobeprovider_box"),     //转为盒子
    business_customer_admin_tobeprovider_submit = $("#business_customer_admin_tobeprovider_submit"),  //转为提交
    //人员选择-商务专员
    business_customer_admin_salesman_box        = $("#business_customer_admin_salesman_box"),         //人员选择盒子
    business_customer_admin_salesman_submit     = $("#business_customer_admin_salesman_submit"),      //人员选择提交
    business_customer_admin_salesman_datagrid   = $("#business_customer_admin_salesman_datagrid"),    //人员选择表格
    business_customer_admin_salesman_user       = $("#business_customer_admin_salesman_user"),        //人员选择姓名
    business_customer_admin_salesman_depart     = $("#business_customer_admin_salesman_depart"),      //人员选择部门
    business_customer_admin_salesman_search_btn = $("#business_customer_admin_salesman_search_btn"),  //人员选择搜索
    //人员选择-信息员
    business_customer_admin_provider_box        = $("#business_customer_admin_provider_box"),         //人员选择盒子
    business_customer_admin_provider_submit     = $("#business_customer_admin_provider_submit"),      //人员选择提交
    business_customer_admin_provider_datagrid   = $("#business_customer_admin_provider_datagrid"),    //人员选择表格
    business_customer_admin_provider_user       = $("#business_customer_admin_provider_user"),        //人员选择姓名
    business_customer_admin_provider_search_btn = $("#business_customer_admin_provider_search_btn");  //人员选择搜索

    //接口对象-----------------------------------------------------------------------------------------------
    if( window.STATE == "local" ){

        //本地接口
        var business_customer_admin_api = {
            datagrid            : LOCAL + "Test/test_datagrid.json",                                  //数据表格
            datagrid_filelist   : LOCAL + "Test/Business/customer_filelist.json",                     //客户附件表格
            datagrid_record     : LOCAL + "Test/test_datagrid.json",                                  //操作记录表格
            datagrid_salesman   : LOCAL + "Test/test_datagrid.json",                                  //人员选择表格-商务专员
            datagrid_provider   : LOCAL + "Test/test_datagrid.json",                                  //人员选择表格-信息员
            select              : LOCAL + "Test/test_select.json",                                    //下拉选择
            modal_show          : LOCAL + "Test/Business/customer_edit.json",                         //查看盒子
        }

    } else if ( window.STATE == "route" ){
    }

    //数据表格-----------------------------------------------------------------------------------------------
    business_customer_admin_datagrid.datagrid({
        height      : zui_datagrid_height(business_customer_admin_datagrid),
        sortable    : false,
        cache       : false,
        showRowIndex: true,
        checkable   : true,
        checkByClickRow:false,
        selectable  : false,
        configs     : {
            R0:{className:"text-center"},
            C1:{className:"cell-hidden"}
        },
        states      : {
            pager           : {
                page        : 1,
                recPerPage  : window.REC_PER_PAGE,
            }
        },
        dataSource : {
            cols   : [
                {name:"id",      label:"ID",      width:49},
                {name:"username",label:"项目编号",width:100,html:true,
                    valueOperator : {
                        getter : function(dataValue,cell){
                            return `<a rowIndex="${cell.rowIndex}" onclick=template_page_open('detail_customer',$(this))>${dataValue}</a>`;
                        }
                    }
                },
                {name:"text8",   label:"项目名称",    width:150},
                {name:"name",    label:"联系人",      width:80 },
                {name:"name",    label:"信息员",      width:80 },
                {name:"name",    label:"业务员",      width:80 },
                {name:"name",    label:"设计师",      width:80 },
                {name:"tex10",   label:"项目状态",    width:150},
                {name:"text2",   label:"房源状态",    width:80 },
                {name:"text2",   label:"回访过期",    width:80 },
                {name:"tex10",   label:"装修地址",    width:150},
                {name:"",        label:"操作",        width:150,html:true,
                    valueOperator : {
                        getter : function(dataValue,cell){
                            var data = cell.config.data;
                            return `
                            <a class="business_customer_admin_turnProvider_btn" rowIndex="${cell.rowIndex}" rowItem="${data.username}" rowPre="${data.name}">转移信息员</a> 
                            <a class="business_customer_admin_tobeprovider_btn" rowIndex="${cell.rowIndex}">转为信息员</a>
                            `;
                        }
                    }
                }
            ],
            remote : function(){
                return {
                    url     : business_customer_admin_api.datagrid,
                    type    : "POST",
                    dataType: "json",
                }
            }
        }
    });

    //变量声明-----------------------------------------------------------------------------------------------
    var
    business_customer_admin_datagrid_obj     = business_customer_admin_datagrid.data("zui.datagrid"), //表格对象
    business_customer_admin_turnProvider_btn = ".business_customer_admin_turnProvider_btn",           //转移信息员
    business_customer_admin_tobeprovider_btn = ".business_customer_admin_tobeprovider_btn";           //转为信息员

    //搜索按钮-----------------------------------------------------------------------------------------------
    business_customer_admin_search_btn.click(function(){

        //字段整理
        var keyword
        = "?sid="    + business_customer_admin_tool_keys.val()
        + "&search=" + business_customer_admin_tool_search.val()
        + "&state="  + business_customer_admin_tool_select1.val();

        //GET提交
        zui_datagrid_render(business_customer_admin_datagrid_obj,business_customer_admin_api.datagrid+keyword);

    });
  
    //批量转移客户按钮-----------------------------------------------------------------------------------------------
    business_customer_admin_turnSalesman_btn.click(function(){
        
        //数据复原
        business_customer_admin_turnSalesman_now.attr("dataId","");
        common_form_reset();

        //批量取值
        var data_arr = business_customer_admin_datagrid_obj.getCheckItems().filter(function(e){return e});
        if( data_arr.length>0 ){
            
            //ID获取
            var data_id = [];
            for(var i=0;i<data_arr.length;i++){
                data_id.push(data_arr[i].id);
            }

            //项目编号获取
            var data_item = [];
            for(var x=0;x<data_id.length;x++){
                data_item.push(data_arr[x].username);
            }

            //原商务专员获取
            var data_pre = [];
            for(var p=0;p<data_id.length;p++){
                data_pre.push(data_arr[p].name);
            }

            //数据赋值
            business_customer_admin_turnSalesman_item.val(data_item.join(","));
            business_customer_admin_turnSalesman_pre.val(data_pre.join(","));
            business_customer_admin_turnSalesman_submit.attr("dataId",data_id.join(","));

            //面板显示
            business_customer_admin_turnSalesman_box.modal("show");

        } else {
            um_tip("至少选择一条数据","1000","text-danger");
        }

    });
    //批量转移客户提交
    business_customer_admin_turnSalesman_submit.click(function(){

        //ID取值
        var data_id = $(this).attr("dataId");

        //远程提交
        $.ajax({
            url     : API.test_response,
            type    : "post",
            dataType: "json",
            data    : { 
                id   : data_id,
                now  : business_customer_admin_turnSalesman_now.attr("dataId")
            },
            success : function(data){
                if( data.status>0 ){
                    um_tip(data.message);
                    zui_datagrid_reset(business_customer_admin_datagrid_obj,business_customer_admin_api.datagrid,"clear");
                } else {
                    um_tip(data.message,"1500","text-danger");
                }
            }
        });

    });

    //批量放弃按钮-----------------------------------------------------------------------------------------------
    business_customer_admin_aban_btn.click(function(){

        //数据复原
        common_form_reset();

        //批量取值
        var data_arr = business_customer_admin_datagrid_obj.getCheckItems().filter(function(e){return e});
        if( data_arr.length>0 ){
            
            //ID获取
            var data_id = [];
            for(var i=0;i<data_arr.length;i++){
                data_id.push(data_arr[i].id);
            }

            //数据赋值
            business_customer_admin_aban_submit.attr("dataId",data_id.join(","));
     
            //面板显示
            business_customer_admin_aban_box.modal("show");

        } else {
            um_tip("至少选择一条数据","1000","text-danger");
        }

    });
    //批量放弃提交
    business_customer_admin_aban_submit.click(function(){

        //ID取值
        var data_id = $(this).attr("dataId");

        //远程提交
        $.ajax({
            url     : API.test_response,
            type    : "post",
            dataType: "json",
            data    : { 
                id : data_id,
                type : business_customer_admin_aban_type.val(),
                reason : business_customer_admin_aban_reason.val(),
            },
            success : function(data){
                if( data.status>0 ){
                    um_tip(data.message);
                    zui_datagrid_reset(business_customer_admin_datagrid_obj,business_customer_admin_api.datagrid,"clear");
                } else {
                    um_tip(data.message,"1500","text-danger");
                }
            }
        });

    });

    //批量客户交接按钮-----------------------------------------------------------------------------------------------
    business_customer_admin_change_btn.click(function(){
 
        //数据复原
        business_customer_admin_turn_quit.attr("dataId","");
        business_customer_admin_turn_target.attr("dataId","");
        common_form_reset();

        //批量取值
        var data_arr = business_customer_admin_datagrid_obj.getCheckItems().filter(function(e){return e});
        if( data_arr.length>0 ){
            
            //ID获取
            var data_id = [];
            for(var i=0;i<data_arr.length;i++){
                data_id.push(data_arr[i].id);
            }

            //数据赋值
            business_customer_admin_change_submit.attr("dataId",data_id.join(","));
     
            //面板显示
            business_customer_admin_change_box.modal("show");

        } else {
            um_tip("至少选择一条数据","1000","text-danger");
        }
 
    });
    //批量客户交接提交
    business_customer_admin_change_submit.click(function(){

        //ID取值
        var data_id = $(this).attr("dataId");

        //远程提交
        $.ajax({
            url     : API.test_response,
            type    : "post",
            dataType: "json",
            data    : { 
                id : data_id,
                quit : business_customer_admin_turn_quit.attr("dataId"),
                target : business_customer_admin_turn_target.attr("dataId")
            },
            success : function(data){
                if( data.status>0 ){
                    um_tip(data.message);
                    zui_datagrid_reset(business_customer_admin_datagrid_obj,business_customer_admin_api.datagrid,"clear");
                } else {
                    um_tip(data.message,"1500","text-danger");
                }
            }
        });

    });

    //导出按钮
    business_customer_admin_export_btn.click(function(){

        //批量取值
        var data_arr = business_customer_admin_datagrid_obj.getCheckItems().filter(function(e){return e});
        if( data_arr.length>0 ){
            
            //ID获取
            var data_id = [];
            for(var i=0;i<data_arr.length;i++){
                data_id.push(data_arr[i].id);
            }

            //远程提交
            $.ajax({
                url     : API.test_response,
                type    : "post",
                dataType: "json",
                data    : {
                    id      : data_id.join(","),
                    keys    : business_customer_admin_tool_keys.val(),
                    search  : business_customer_admin_tool_search.val(),
                    state   : business_customer_admin_tool_select1.val(),
                },
                beforesend : function(){
                    um_tip("导出中…");
                },
                success : function(data){
                    if( data.status>0 ){
                        window.open(API.test_export);
                    } else {
                        um_tip(data.message,"1500","text-danger");
                    }
                }
            });

        } else {
            um_tip("至少选择一条数据","1000","text-danger");
        }

    });

    //转移信息员-----------------------------------------------------------------------------------------
    $(document).on("click",business_customer_admin_turnProvider_btn,function(){
 
        //数据复原
        business_customer_admin_turnProvider_now.attr("dataId","");
        common_form_reset();

        //数据取值
        var data_id = $(this).attr("rowIndex");
        var rowItem = $(this).attr("rowItem");
        var rowPre  = $(this).attr("rowPre");

        //数据赋值
        business_customer_admin_turnProvider_submit.attr("dataId",data_id);
        business_customer_admin_turnProvider_item.val(rowItem);
        business_customer_admin_turnProvider_pre.val(rowPre);

        //面板显示
        business_customer_admin_turnProvider_box.modal("show");
 
    });
    //转移信息员提交
    business_customer_admin_turnProvider_submit.click(function(){

        //数据ID
        var data_id = $(this).attr("dataId");

        //远程提交
        $.ajax({
            url     : API.test_response,
            type    : "post",
            dataType: "json",
            data    : { 
                id  : data_id,
                now : business_customer_admin_turnProvider_now.attr("dataId")
            },
            success : function(data){
                if( data.status>0 ){
                    um_tip(data.message);
                    zui_datagrid_reset(business_customer_admin_datagrid_obj,business_customer_admin_api.datagrid);
                } else {
                    um_tip(data.message,"1500","text-danger");
                }
            }
        });

    });

    //转为信息员-----------------------------------------------------------------------------------------
    $(document).on("click",business_customer_admin_tobeprovider_btn,function(){

        //数据复原
        common_form_reset();

        //数据取值
        var data_id = $(this).attr("rowIndex");

        //数据赋值
        business_customer_admin_tobeprovider_submit.attr("dataId",data_id);

        //面板显示
        business_customer_admin_tobeprovider_box.modal("show");

    });
    //转为信息员提交
    business_customer_admin_tobeprovider_submit.click(function(){

        //数据ID
        var data_id = $(this).attr("dataId");

        //远程提交
        $.ajax({
            url     : API.test_response,
            type    : "post",
            dataType: "json",
            data    : { 
                id   : data_id,
            },
            success : function(data){
                if( data.status>0 ){
                    um_tip(data.message);
                    zui_datagrid_reset(business_customer_admin_datagrid_obj,business_customer_admin_api.datagrid);
                } else {
                    um_tip(data.message,"1500","text-danger");
                }
            }
        });

    });

    //人员选择-商务专员------------------------------------------------------------------------------------------
    //数据列表
    business_customer_admin_salesman_datagrid.datagrid({
        height      : "page",
        sortable    : false,
        cache       : false,
        showRowIndex: true,
        checkable   : true,
        selectable  : false,
        configs     : {
            R0:{className:"text-center"},
            C1:{className:"cell-hidden"}
        },
        states      : {
            pager           : {
                page        : 1,
                recPerPage  : window.REC_PER_PAGE,
            }
        },
        dataSource : {
            cols   : [
                {name:"id",label:"ID",  width:1 },
                {name:"name",label:"姓名",width:80 },
                {name:"departname",label:"部门",width:100},
                {name:"positionname",label:"职务"}
            ],
            remote : function(){
                return {
                    url     : business_customer_admin_api.datagrid_salesman,
                    type    : "POST",
                    dataType: "json",
                }
            }
        }
    });
    var business_customer_admin_salesman_datagrid_obj = business_customer_admin_salesman_datagrid.data("zui.datagrid");

    //搜索按钮
    business_customer_admin_salesman_search_btn.click(function(){

        //字段整理
        var keyword
        = "?search=" + business_customer_admin_salesman_user.val()
        + "&depart=" + business_customer_admin_salesman_depart.val();

        //GET提交
        zui_datagrid_render(business_customer_admin_salesman_datagrid_obj,business_customer_admin_api.datagrid_salesman+keyword);

    });
    //点击显示
    $(".salesman_person_btn").click(function(){

        //按钮ID获取
        COMMON_PERSON_BTNID = $(this).attr("id");

        //批量勾选去除
        var data_arr = business_customer_admin_salesman_datagrid_obj.getCheckItems().filter(function(e){return e});
        for(var i=0;i<data_arr.length;i++){
            business_customer_admin_salesman_datagrid_obj.checkRow(i,false);
        }

        //部门请求
        $.ajax({
            url     : business_customer_admin_api.select,
            type    : "post",
            dataType: "json",
            data    : {},
            success : function(data){
                if( data.status>0 ){
                    var data = data.data;
                    var option = "<option value='0'>全部</option>";
                    for(var i=0;i<data.length;i++){
                        option += "<option value='"+data[i].id+"'>"+data[i].name+"</option>"
                    }
                    business_customer_admin_salesman_depart.html(option);
                }
            }
        });

        //面板显示
        business_customer_admin_salesman_box.modal("show");

    });
    //提交按钮
    business_customer_admin_salesman_submit.click(function(){
        
        //批量取值
        var data_arr = business_customer_admin_salesman_datagrid_obj.getCheckItems().filter(function(e){return e});
       
        if( data_arr.length==1 ){
            
            //数据赋值
            $("#"+COMMON_PERSON_BTNID).val(data_arr[0].name);
            $("#"+COMMON_PERSON_BTNID).attr("dataId",data_arr[0].id);

            //面板显示
            business_customer_admin_salesman_box.modal("hide");

        } else {
            um_tip("请选择一条数据","1000","text-danger");
        }

    });

    //人员选择-信息员------------------------------------------------------------------------------------------
    //数据列表
    business_customer_admin_provider_datagrid.datagrid({
        height      : "page",
        sortable    : false,
        cache       : false,
        showRowIndex: true,
        checkable   : true,
        selectable  : false,
        configs     : {
            R0:{className:"text-center"},
            C1:{className:"cell-hidden"}
        },
        states      : {
            pager           : {
                page        : 1,
                recPerPage  : window.REC_PER_PAGE,
            }
        },
        dataSource : {
            cols   : [
                {name:"id",   label:"ID",  width:1  },
                {name:"name", label:"姓名",width:80 },
                {name:"tex10",label:"公司",width:150},
                {name:"name", label:"商务专员",width:100},
                {name:"text1",label:"级别"}
            ],
            remote : function(){
                return {
                    url     : business_customer_admin_api.datagrid_provider,
                    type    : "POST",
                    dataType: "json",
                }
            }
        }
    });
    var business_customer_admin_provider_datagrid_obj = business_customer_admin_provider_datagrid.data("zui.datagrid");

    //搜索按钮
    business_customer_admin_provider_search_btn.click(function(){

        //字段整理
        var keyword = "?search=" + business_customer_admin_provider_user.val();

        //GET提交
        zui_datagrid_render(business_customer_admin_provider_datagrid_obj,business_customer_admin_api.datagrid_provider+keyword);

    });
    //点击显示
    $(".provider_person_btn").click(function(){

        //按钮ID获取
        COMMON_PERSON_BTNID = $(this).attr("id");

        //批量勾选去除
        var data_arr = business_customer_admin_provider_datagrid_obj.getCheckItems().filter(function(e){return e});
        for(var i=0;i<data_arr.length;i++){
            business_customer_admin_provider_datagrid_obj.checkRow(i,false);
        }

        //面板显示
        business_customer_admin_provider_box.modal("show");

    });
    //提交按钮
    business_customer_admin_provider_submit.click(function(){
        
        //批量取值
        var data_arr = business_customer_admin_provider_datagrid_obj.getCheckItems().filter(function(e){return e});
       
        if( data_arr.length==1 ){
            
            //数据赋值
            $("#"+COMMON_PERSON_BTNID).val(data_arr[0].name);
            $("#"+COMMON_PERSON_BTNID).attr("dataId",data_arr[0].id);

            //面板显示
            business_customer_admin_provider_box.modal("hide");

        } else {
            um_tip("请选择一条数据","1000","text-danger");
        }

    });

});//预加载结尾
</script>